<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.64">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <title>Asp.Net MVC和Asp.Net Core的支持断点续传和多线程下载的ResumeFileResult</title><meta name="description" content="">
    <link rel="preload" href="/assets/style-8a38cc2d.css" as="style"><link rel="stylesheet" href="/assets/style-8a38cc2d.css">
    <link rel="modulepreload" href="/assets/app-91c53015.js"><link rel="modulepreload" href="/assets/Use.html-45474b20.js"><link rel="modulepreload" href="/assets/Use.html-6dfcaa00.js"><link rel="prefetch" href="/assets/index.html-be18908e.js" as="script"><link rel="prefetch" href="/assets/404.html-60b35caa.js" as="script"><link rel="prefetch" href="/assets/index.html-28f12e4c.js" as="script"><link rel="prefetch" href="/assets/404.html-1e82d74e.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/" class=""><img class="logo" src="/images/20254980.png" alt><!--v-if--></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a href="/" class="" aria-label="首页"><!--[--><!--]--> 首页 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/Use.md" class="" aria-label="安装和功能"><!--[--><!--]--> 安装和功能 <!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://replit.com/@ldqk/MasuitToolsDemo?v=1#main.cs" rel="noopener noreferrer" target="_blank" aria-label="在线体验"><!--[--><!--]--> 在线体验 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/ldqk/Masuit.Tools" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a href="/" class="" aria-label="首页"><!--[--><!--]--> 首页 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/Use.md" class="" aria-label="安装和功能"><!--[--><!--]--> 安装和功能 <!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://replit.com/@ldqk/MasuitToolsDemo?v=1#main.cs" rel="noopener noreferrer" target="_blank" aria-label="在线体验"><!--[--><!--]--> 在线体验 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/ldqk/Masuit.Tools" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading">Asp.Net MVC和Asp.Net Core的支持断点续传和多线程下载的ResumeFileResult <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/Use.html#安装程序包" class="router-link-active router-link-exact-active sidebar-item" aria-label="安装程序包"><!--[--><!--]--> 安装程序包 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/Use.html#基础功能包" class="router-link-active router-link-exact-active sidebar-item" aria-label="基础功能包"><!--[--><!--]--> 基础功能包 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Use.html#增值包" class="router-link-active router-link-exact-active sidebar-item" aria-label="增值包"><!--[--><!--]--> 增值包 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/Use.html#为工具库注册配置" class="router-link-active router-link-exact-active sidebar-item" aria-label="为工具库注册配置"><!--[--><!--]--> 为工具库注册配置 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Use.html#特色功能示例代码" class="router-link-active router-link-exact-active sidebar-item" aria-label="特色功能示例代码"><!--[--><!--]--> 特色功能示例代码 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/Use.html#在线体验" class="router-link-active router-link-exact-active sidebar-item" aria-label="在线体验"><!--[--><!--]--> 在线体验 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Use.html#_0-一些创意类型" class="router-link-active router-link-exact-active sidebar-item" aria-label="0. 一些创意类型"><!--[--><!--]--> 0. 一些创意类型 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Use.html#_1-检验字符串是否是email、手机号、url、ip地址、身份证号等" class="router-link-active router-link-exact-active sidebar-item" aria-label="1. 检验字符串是否是Email、手机号、URL、IP地址、身份证号等"><!--[--><!--]--> 1. 检验字符串是否是Email、手机号、URL、IP地址、身份证号等 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Use.html#_2-硬件监测-仅支持windows-部分函数仅支持物理机模式" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.硬件监测(仅支持Windows，部分函数仅支持物理机模式)"><!--[--><!--]--> 2.硬件监测(仅支持Windows，部分函数仅支持物理机模式) <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Use.html#_3-html的防xss处理" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.html的防XSS处理："><!--[--><!--]--> 3.html的防XSS处理： <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Use.html#_4-整理windows系统的内存" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.整理Windows系统的内存："><!--[--><!--]--> 4.整理Windows系统的内存： <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Use.html#_5-任意进制转换-中文数字" class="router-link-active router-link-exact-active sidebar-item" aria-label="5.任意进制转换/中文数字"><!--[--><!--]--> 5.任意进制转换/中文数字 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Use.html#_6-纳秒级性能计时器" class="router-link-active router-link-exact-active sidebar-item" aria-label="6.纳秒级性能计时器"><!--[--><!--]--> 6.纳秒级性能计时器 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Use.html#_7-产生分布式唯一有序短id-雪花id" class="router-link-active router-link-exact-active sidebar-item" aria-label="7.产生分布式唯一有序短id(雪花id)"><!--[--><!--]--> 7.产生分布式唯一有序短id(雪花id) <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Use.html#_8-农历转换" class="router-link-active router-link-exact-active sidebar-item" aria-label="8.农历转换"><!--[--><!--]--> 8.农历转换 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Use.html#_9-linq表达式树扩展" class="router-link-active router-link-exact-active sidebar-item" aria-label="9.Linq表达式树扩展"><!--[--><!--]--> 9.Linq表达式树扩展 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Use.html#_10-模版引擎" class="router-link-active router-link-exact-active sidebar-item" aria-label="10.模版引擎"><!--[--><!--]--> 10.模版引擎 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Use.html#_11-list转datatable" class="router-link-active router-link-exact-active sidebar-item" aria-label="11.List转Datatable"><!--[--><!--]--> 11.List转Datatable <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Use.html#_12-文件压缩解压" class="router-link-active router-link-exact-active sidebar-item" aria-label="12.文件压缩解压"><!--[--><!--]--> 12.文件压缩解压 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Use.html#_13-简易日志组件-又不是不能用-jpg" class="router-link-active router-link-exact-active sidebar-item" aria-label="13.简易日志组件(又不是不能用.jpg)"><!--[--><!--]--> 13.简易日志组件(又不是不能用.jpg) <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Use.html#_14-多线程后台下载" class="router-link-active router-link-exact-active sidebar-item" aria-label="14.多线程后台下载"><!--[--><!--]--> 14.多线程后台下载 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Use.html#_15-加密解密-hash" class="router-link-active router-link-exact-active sidebar-item" aria-label="15.加密解密/hash"><!--[--><!--]--> 15.加密解密/hash <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Use.html#_16-实体校验" class="router-link-active router-link-exact-active sidebar-item" aria-label="16.实体校验"><!--[--><!--]--> 16.实体校验 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Use.html#_17-html操作" class="router-link-active router-link-exact-active sidebar-item" aria-label="17.HTML操作"><!--[--><!--]--> 17.HTML操作 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Use.html#_18-ip地址和url" class="router-link-active router-link-exact-active sidebar-item" aria-label="18.IP地址和URL"><!--[--><!--]--> 18.IP地址和URL <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Use.html#_19-对象属性值合并" class="router-link-active router-link-exact-active sidebar-item" aria-label="19.对象属性值合并"><!--[--><!--]--> 19.对象属性值合并 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Use.html#_20-元素去重" class="router-link-active router-link-exact-active sidebar-item" aria-label="20.元素去重"><!--[--><!--]--> 20.元素去重 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Use.html#_21-枚举扩展" class="router-link-active router-link-exact-active sidebar-item" aria-label="21.枚举扩展"><!--[--><!--]--> 21.枚举扩展 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Use.html#_22-定长队列和concurrenthashset实现" class="router-link-active router-link-exact-active sidebar-item" aria-label="22.定长队列和ConcurrentHashSet实现"><!--[--><!--]--> 22.定长队列和ConcurrentHashSet实现 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Use.html#_23-反射操作" class="router-link-active router-link-exact-active sidebar-item" aria-label="23.反射操作"><!--[--><!--]--> 23.反射操作 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Use.html#_24-邮件发送" class="router-link-active router-link-exact-active sidebar-item" aria-label="24.邮件发送"><!--[--><!--]--> 24.邮件发送 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Use.html#_25-图像的简单处理" class="router-link-active router-link-exact-active sidebar-item" aria-label="25.图像的简单处理"><!--[--><!--]--> 25.图像的简单处理 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Use.html#_26-随机数" class="router-link-active router-link-exact-active sidebar-item" aria-label="26.随机数"><!--[--><!--]--> 26.随机数 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Use.html#_27-权重随机筛选功能" class="router-link-active router-link-exact-active sidebar-item" aria-label="27.权重随机筛选功能"><!--[--><!--]--> 27.权重随机筛选功能 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Use.html#_28-ef-core支持addorupdate方法" class="router-link-active router-link-exact-active sidebar-item" aria-label="28.EF Core支持AddOrUpdate方法"><!--[--><!--]--> 28.EF Core支持AddOrUpdate方法 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Use.html#_29-敏感信息掩码" class="router-link-active router-link-exact-active sidebar-item" aria-label="29.敏感信息掩码"><!--[--><!--]--> 29.敏感信息掩码 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Use.html#_30-集合扩展" class="router-link-active router-link-exact-active sidebar-item" aria-label="30.集合扩展"><!--[--><!--]--> 30.集合扩展 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Use.html#_31-mime类型" class="router-link-active router-link-exact-active sidebar-item" aria-label="31.Mime类型"><!--[--><!--]--> 31.Mime类型 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Use.html#_32-日期时间扩展" class="router-link-active router-link-exact-active sidebar-item" aria-label="32.日期时间扩展"><!--[--><!--]--> 32.日期时间扩展 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Use.html#_33-流相关" class="router-link-active router-link-exact-active sidebar-item" aria-label="33.流相关"><!--[--><!--]--> 33.流相关 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Use.html#_34-类型操作" class="router-link-active router-link-exact-active sidebar-item" aria-label="34.类型操作"><!--[--><!--]--> 34.类型操作 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Use.html#_35-ini配置文件操作-仅支持windows" class="router-link-active router-link-exact-active sidebar-item" aria-label="35.INI配置文件操作(仅支持Windows)"><!--[--><!--]--> 35.INI配置文件操作(仅支持Windows) <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Use.html#_36-雷达图计算引擎" class="router-link-active router-link-exact-active sidebar-item" aria-label="36.雷达图计算引擎"><!--[--><!--]--> 36.雷达图计算引擎 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Use.html#_37-树形结构实现" class="router-link-active router-link-exact-active sidebar-item" aria-label="37.树形结构实现"><!--[--><!--]--> 37.树形结构实现 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Use.html#_38-简单的excel导出" class="router-link-active router-link-exact-active sidebar-item" aria-label="38.简单的Excel导出"><!--[--><!--]--> 38.简单的Excel导出 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Use.html#_39-efcore实用扩展" class="router-link-active router-link-exact-active sidebar-item" aria-label="39.EFCore实用扩展"><!--[--><!--]--> 39.EFCore实用扩展 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Use.html#_40-任何类型支持链式调用" class="router-link-active router-link-exact-active sidebar-item" aria-label="40.任何类型支持链式调用"><!--[--><!--]--> 40.任何类型支持链式调用 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Use.html#_41-newtonsoft-json的只允许字段-反-序列化行为的契约解释器" class="router-link-active router-link-exact-active sidebar-item" aria-label="41.Newtonsoft.Json的只允许字段(反)序列化行为的契约解释器"><!--[--><!--]--> 41.Newtonsoft.Json的只允许字段(反)序列化行为的契约解释器 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Use.html#_42-asp-net-core-action同时支持querystring、表单和json请求类型的模型绑点器bodyordefaultmodelbinder" class="router-link-active router-link-exact-active sidebar-item" aria-label="42. ASP.NET Core Action同时支持queryString、表单和json请求类型的模型绑点器BodyOrDefaultModelBinder"><!--[--><!--]--> 42. ASP.NET Core Action同时支持queryString、表单和json请求类型的模型绑点器BodyOrDefaultModelBinder <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Use.html#_43-字符串simhash相似度算法" class="router-link-active router-link-exact-active sidebar-item" aria-label="43. 字符串SimHash相似度算法"><!--[--><!--]--> 43. 字符串SimHash相似度算法 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Use.html#_44-真实文件类型探测" class="router-link-active router-link-exact-active sidebar-item" aria-label="44. 真实文件类型探测"><!--[--><!--]--> 44. 真实文件类型探测 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Use.html#_45-动态类型扩展" class="router-link-active router-link-exact-active sidebar-item" aria-label="45. 动态类型扩展"><!--[--><!--]--> 45. 动态类型扩展 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Use.html#_46-反病毒-仅支持windows" class="router-link-active router-link-exact-active sidebar-item" aria-label="46. 反病毒(仅支持Windows)"><!--[--><!--]--> 46. 反病毒(仅支持Windows) <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Use.html#_47-生成验证码" class="router-link-active router-link-exact-active sidebar-item" aria-label="47. 生成验证码"><!--[--><!--]--> 47. 生成验证码 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Use.html#_48-distributedcache扩展" class="router-link-active router-link-exact-active sidebar-item" aria-label="48. DistributedCache扩展"><!--[--><!--]--> 48. DistributedCache扩展 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Use.html#_49-viewdata扩展" class="router-link-active router-link-exact-active sidebar-item" aria-label="49. ViewData扩展"><!--[--><!--]--> 49. ViewData扩展 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Use.html#_50-线程上下文存取临时值" class="router-link-active router-link-exact-active sidebar-item" aria-label="50. 线程上下文存取临时值"><!--[--><!--]--> 50. 线程上下文存取临时值 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Use.html#_51-asp-net-core自动扫描注册服务" class="router-link-active router-link-exact-active sidebar-item" aria-label="51. ASP.NET Core自动扫描注册服务"><!--[--><!--]--> 51. ASP.NET Core自动扫描注册服务 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/Use.html#支持-asp-net-core-2-0" class="router-link-active router-link-exact-active sidebar-item" aria-label="支持 ASP.NET Core 2.0+"><!--[--><!--]--> 支持 ASP.NET Core 2.0+ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Use.html#如何使用" class="router-link-active router-link-exact-active sidebar-item" aria-label="如何使用"><!--[--><!--]--> 如何使用 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/Use.html#net-framework" class="router-link-active router-link-exact-active sidebar-item" aria-label=".NET Framework"><!--[--><!--]--> .NET Framework <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Use.html#asp-net-core" class="router-link-active router-link-exact-active sidebar-item" aria-label="Asp.Net Core"><!--[--><!--]--> Asp.Net Core <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h2 id="安装程序包" tabindex="-1"><a class="header-anchor" href="#安装程序包" aria-hidden="true">#</a> 安装程序包</h2><h3 id="基础功能包" tabindex="-1"><a class="header-anchor" href="#基础功能包" aria-hidden="true">#</a> 基础功能包</h3><p><code>.NET Framework版本的包因打包环境异常，无法正常发布更新，目前暂时停更~</code></p><h4 id="net-framework-≥-4-6-1" tabindex="-1"><a class="header-anchor" href="#net-framework-≥-4-6-1" aria-hidden="true">#</a> .NET Framework ≥ 4.6.1</h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>PM<span class="token operator">&gt;</span> Install-Package Masuit.Tools.Net
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="net-standard-≥-2-1-或只想使用一些基本功能" tabindex="-1"><a class="header-anchor" href="#net-standard-≥-2-1-或只想使用一些基本功能" aria-hidden="true">#</a> .NET Standard ≥ 2.1 或只想使用一些基本功能</h4><p><code>通用项目推荐首选包</code></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>PM<span class="token operator">&gt;</span> Install-Package Masuit.Tools.Abstraction
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="net-core-≥-2-1" tabindex="-1"><a class="header-anchor" href="#net-core-≥-2-1" aria-hidden="true">#</a> .NET Core ≥ 2.1</h4><p><code>.NET Core项目推荐首选包</code></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>PM<span class="token operator">&gt;</span> Install-Package Masuit.Tools.Core
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="net-framework-4-5特供版" tabindex="-1"><a class="header-anchor" href="#net-framework-4-5特供版" aria-hidden="true">#</a> .NET Framework 4.5特供版</h4><p>请注意：<code>这是.NET Framework 4.5的专用版本，相比4.6.1及.NET Core的版本，阉割了Redis、HTML、文件压缩、ASP.NET扩展、硬件监测、Session扩展等一些功能。</code><strong>如果你的项目版本高于4.5，请务必使用上述版本的包，以享受完整的功能体验！</strong></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>PM<span class="token operator">&gt;</span> Install-Package Masuit.Tools.Net45
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="增值包" tabindex="-1"><a class="header-anchor" href="#增值包" aria-hidden="true">#</a> 增值包</h3><h4 id="masuit-tools-aspnetcore" tabindex="-1"><a class="header-anchor" href="#masuit-tools-aspnetcore" aria-hidden="true">#</a> Masuit.Tools.AspNetCore</h4><p><code>AspNetCore项目推荐首选包</code> ASP.NET Core Web专用包，包含Masuit.Tools.Core的全部功能，并且增加了一些对ASP.NET Core Web功能的额外支持。</p><h4 id="masuit-tools-excel" tabindex="-1"><a class="header-anchor" href="#masuit-tools-excel" aria-hidden="true">#</a> Masuit.Tools.Excel</h4><p>Excel导入导出的专用独立包</p><h4 id="masuit-tools-nosql-mongodbclient" tabindex="-1"><a class="header-anchor" href="#masuit-tools-nosql-mongodbclient" aria-hidden="true">#</a> Masuit.Tools.NoSQL.MongoDBClient</h4><p>mongodb的封装操作类独立包</p><h2 id="为工具库注册配置" tabindex="-1"><a class="header-anchor" href="#为工具库注册配置" aria-hidden="true">#</a> 为工具库注册配置</h2><p>工具库需要用到外部配置节，.NET Framework项目配置在web.config/app.config的AppSettings配置节中，.NET Core项目配置在appsettings.json中：</p><ol><li>EmailDomainWhiteList，邮箱校验需要用到的白名单域名，英文逗号分隔，每个元素支持正则表达式，若未配置，则不启用邮箱校验白名单，示例: <code>&quot;^\\w{1,5}@qq.com,^\\w{1,5}@163.com,^\\w{1,5}@gmail.com,^\\w{1,5}@outlook.com&quot;</code></li><li>EmailDomainBlockList，邮箱校验需要用到的黑名单域名，英文逗号分隔，每个元素支持正则表达式，且黑名单优先级高于白名单，若未配置，则不启用邮箱校验黑白名单</li></ol><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token function">Startup</span><span class="token punctuation">(</span><span class="token class-name">IConfiguration</span> configuration<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    configuration<span class="token punctuation">.</span><span class="token function">AddToMasuitTools</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 若未调用，则默认自动尝试加载appsettings.json</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="特色功能示例代码" tabindex="-1"><a class="header-anchor" href="#特色功能示例代码" aria-hidden="true">#</a> 特色功能示例代码</h2><h3 id="在线体验" tabindex="-1"><a class="header-anchor" href="#在线体验" aria-hidden="true">#</a> 在线体验</h3><p>https://replit.com/@ldqk/MasuitToolsDemo?v=1#main.cs</p><h3 id="_0-一些创意类型" tabindex="-1"><a class="header-anchor" href="#_0-一些创意类型" aria-hidden="true">#</a> 0. 一些创意类型</h3><p><code>DisposableDictionary</code>：可被Disposable的字典类型，用于存放Value是Disposable类型的数据，用法和普通字典一致</p><p><code>NullableConcurrentDictionary</code>/<code>NullableDictionary</code>：Key可为null的字典类型，用法和普通字典一致</p><p><code>ConcurrentHashSet</code>：并发HashSet，用法和HashSet一致</p><p><code>ConcurrentLimitedQueue</code>：定长并发队列，特点是长度是固定的，用法与ConcurrentQueue一致</p><p><code>LimitedQueue</code>：定长队列，特点是长度是固定的，用法与Queue一致</p><p><code>LargeMemoryStream</code>：超大内存流，最大可支持1TB数据，推荐当数据流大于2GB时使用，用法与MemoryStream一致</p><p><code>PooledMemoryStream</code>：池化内存流，可内存复用，用法与MemoryStream一致，性能比MemoryStream好</p><p><code>ITree&lt;T&gt;</code>：树形实体接口约束，实现该接口可让类型实现一些树形操作</p><p><code>ChineseCalendar</code>：中国农历类型，可以实现天干地支节气等数据的获取</p><p><code>Clay</code>/<code>DynamicFactory</code>：粘土动态类型，可实现类似js的弱类型编程</p><p><code>RadarChart</code>：雷达图类型，可用于做数据分析或用户行为画像</p><p><code>Circle</code>：圆形类型，可实现⚪的相交相切相离的判断</p><p><code>Sphere</code>：球体类型，可实现计算球体上两点的弧长计算，相交相切相离的判断</p><p><code>MimeMapper</code>：mime类型映射</p><p>具体用法，可参阅后文详细示例：</p><h3 id="_1-检验字符串是否是email、手机号、url、ip地址、身份证号等" tabindex="-1"><a class="header-anchor" href="#_1-检验字符串是否是email、手机号、url、ip地址、身份证号等" aria-hidden="true">#</a> 1. 检验字符串是否是Email、手机号、URL、IP地址、身份证号等</h3><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token keyword">var</span> <span class="token punctuation">(</span>isMatch<span class="token punctuation">,</span> match<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">&quot;337845818@qq.com&quot;</span><span class="token punctuation">.</span><span class="token function">MatchEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 可在appsetting.json中添加EmailDomainWhiteList和EmailDomainBlockList配置邮箱域名黑白名单，逗号分隔，如&quot;EmailDomainBlockList&quot;: &quot;^\\w{1,5}@qq.com,^\\w{1,5}@163.com,^\\w{1,5}@gmail.com,^\\w{1,5}@outlook.com&quot;,</span>
<span class="token class-name"><span class="token keyword">bool</span></span> isInetAddress <span class="token operator">=</span> <span class="token string">&quot;114.114.114.114&quot;</span><span class="token punctuation">.</span><span class="token function">MatchInetAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 匹配IP地址</span>
<span class="token class-name"><span class="token keyword">bool</span></span> isUrl <span class="token operator">=</span> <span class="token string">&quot;http://masuit.org/20/history&quot;</span><span class="token punctuation">.</span><span class="token function">MatchUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 匹配url</span>
<span class="token class-name"><span class="token keyword">bool</span></span> isPhoneNumber <span class="token operator">=</span> <span class="token string">&quot;15205201520&quot;</span><span class="token punctuation">.</span><span class="token function">MatchPhoneNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 匹配手机号</span>
<span class="token class-name"><span class="token keyword">bool</span></span> isLandline <span class="token operator">=</span> <span class="token string">&quot;01088888888&quot;</span><span class="token punctuation">.</span><span class="token function">MatchLandline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 匹配座机号</span>
<span class="token class-name"><span class="token keyword">bool</span></span> isIdentifyCard <span class="token operator">=</span> <span class="token string">&quot;312000199502230660&quot;</span><span class="token punctuation">.</span><span class="token function">MatchIdentifyCard</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 校验中国大陆身份证号</span>
<span class="token class-name"><span class="token keyword">bool</span></span> isCNPatentNumber <span class="token operator">=</span> <span class="token string">&quot;200410018477.9&quot;</span><span class="token punctuation">.</span><span class="token function">MatchCNPatentNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 校验中国专利申请号或专利号，是否带校验位，校验位前是否带“.”，都可以校验，待校验的号码前不要带CN、ZL字样的前缀</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-硬件监测-仅支持windows-部分函数仅支持物理机模式" tabindex="-1"><a class="header-anchor" href="#_2-硬件监测-仅支持windows-部分函数仅支持物理机模式" aria-hidden="true">#</a> 2.硬件监测(仅支持Windows，部分函数仅支持物理机模式)</h3><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token class-name"><span class="token keyword">float</span></span> load <span class="token operator">=</span> SystemInfo<span class="token punctuation">.</span>CpuLoad<span class="token punctuation">;</span><span class="token comment">// 获取CPU占用率</span>
<span class="token class-name"><span class="token keyword">long</span></span> physicalMemory <span class="token operator">=</span> SystemInfo<span class="token punctuation">.</span>PhysicalMemory<span class="token punctuation">;</span><span class="token comment">// 获取物理内存总数</span>
<span class="token class-name"><span class="token keyword">long</span></span> memoryAvailable <span class="token operator">=</span> SystemInfo<span class="token punctuation">.</span>MemoryAvailable<span class="token punctuation">;</span><span class="token comment">// 获取物理内存可用率</span>
<span class="token class-name"><span class="token keyword">double</span></span> freePhysicalMemory <span class="token operator">=</span> SystemInfo<span class="token punctuation">.</span><span class="token function">GetFreePhysicalMemory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 获取可用物理内存</span>
<span class="token class-name"><span class="token keyword">double</span></span> temperature <span class="token operator">=</span> SystemInfo<span class="token punctuation">.</span><span class="token function">GetCPUTemperature</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 获取CPU温度</span>
<span class="token class-name"><span class="token keyword">int</span></span> cpuCount <span class="token operator">=</span> SystemInfo<span class="token punctuation">.</span><span class="token function">GetCpuCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 获取CPU核心数</span>
<span class="token class-name"><span class="token keyword">var</span></span> ipAddress <span class="token operator">=</span> SystemInfo<span class="token punctuation">.</span><span class="token function">GetLocalIPs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 获取本机所有IP地址</span>
<span class="token class-name"><span class="token keyword">string</span></span> localUsedIp <span class="token operator">=</span> SystemInfo<span class="token punctuation">.</span><span class="token function">GetLocalUsedIP</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 获取本机当前正在使用的IP地址</span>
<span class="token class-name">IList<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span> macAddress <span class="token operator">=</span> SystemInfo<span class="token punctuation">.</span><span class="token function">GetMacAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 获取本机所有网卡mac地址</span>
<span class="token class-name"><span class="token keyword">string</span></span> osVersion <span class="token operator">=</span> Windows<span class="token punctuation">.</span><span class="token function">GetOsVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 获取操作系统版本</span>
<span class="token class-name">RamInfo</span> ramInfo <span class="token operator">=</span> SystemInfo<span class="token punctuation">.</span><span class="token function">GetRamInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 获取内存信息</span>
<span class="token class-name"><span class="token keyword">var</span></span> cpuSN<span class="token operator">=</span>SystemInfo<span class="token punctuation">.</span><span class="token function">GetCpuInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>SerialNumber<span class="token punctuation">;</span> <span class="token comment">// CPU序列号</span>
<span class="token class-name"><span class="token keyword">var</span></span> driveSN<span class="token operator">=</span>SystemInfo<span class="token punctuation">.</span><span class="token function">GetDiskInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>SerialNumber<span class="token punctuation">;</span> <span class="token comment">// 硬盘序列号</span>

<span class="token comment">// 快速方法</span>
<span class="token class-name"><span class="token keyword">var</span></span> cpuInfos <span class="token operator">=</span> CpuInfo<span class="token punctuation">.</span>Locals<span class="token punctuation">;</span> <span class="token comment">// 快速获取CPU的信息</span>
<span class="token class-name"><span class="token keyword">var</span></span> ramInfo <span class="token operator">=</span> RamInfo<span class="token punctuation">.</span>Local<span class="token punctuation">;</span> <span class="token comment">// 快速获取内存的信息</span>
<span class="token class-name"><span class="token keyword">var</span></span> diskInfos <span class="token operator">=</span> DiskInfo<span class="token punctuation">.</span>Locals<span class="token punctuation">;</span> <span class="token comment">// 快速获取硬盘的信息</span>
<span class="token class-name"><span class="token keyword">var</span></span> biosInfo <span class="token operator">=</span> BiosInfo<span class="token punctuation">.</span>Local<span class="token punctuation">;</span> <span class="token comment">// 快速获取主板的信息</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-html的防xss处理" tabindex="-1"><a class="header-anchor" href="#_3-html的防xss处理" aria-hidden="true">#</a> 3.html的防XSS处理：</h3><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token class-name"><span class="token keyword">string</span></span> html <span class="token operator">=</span> <span class="token string">@&quot;&lt;link href=&#39;/Content/font-awesome/css&#39; rel=&#39;stylesheet&#39;/&gt;
        &lt;!--[if IE 7]&gt;
        &lt;link href=&#39;/Content/font-awesome-ie7.min.css&#39; rel=&#39;stylesheet&#39;/&gt;
        &lt;![endif]--&gt;
        &lt;script src=&#39;/Scripts/modernizr&#39;&gt;&lt;/script&gt;
        &lt;div id=&#39;searchBox&#39; role=&#39;search&#39;&gt;
        &lt;form action=&#39;/packages&#39; method=&#39;get&#39;&gt;
        &lt;span class=&#39;user-actions&#39;&gt;&lt;a href=&#39;/users/account/LogOff&#39;&gt;退出&lt;/a&gt;&lt;/span&gt;
        &lt;input name=&#39;q&#39; id=&#39;searchBoxInput&#39;/&gt;
        &lt;input id=&#39;searchBoxSubmit&#39; type=&#39;submit&#39; value=&#39;Submit&#39; /&gt;
        &lt;/form&gt;
        &lt;/div&gt;&quot;</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">string</span></span> s <span class="token operator">=</span> html<span class="token punctuation">.</span><span class="token function">HtmlSanitizerStandard</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 清理后：&lt;div&gt;&lt;span&gt;&lt;a href=&quot;/users/account/LogOff&quot;&gt;退出&lt;/a&gt;&lt;/span&gt;&lt;/div&gt;</span>
<span class="token class-name"><span class="token keyword">string</span></span> s <span class="token operator">=</span> html<span class="token punctuation">.</span><span class="token function">HtmlSanitizerCustom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 自定义清理</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-整理windows系统的内存" tabindex="-1"><a class="header-anchor" href="#_4-整理windows系统的内存" aria-hidden="true">#</a> 4.整理Windows系统的内存：</h3><p>类似于各大系统优化软件的加速球功能</p><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code>Windows<span class="token punctuation">.</span><span class="token function">ClearMemorySilent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_5-任意进制转换-中文数字" tabindex="-1"><a class="header-anchor" href="#_5-任意进制转换-中文数字" aria-hidden="true">#</a> 5.任意进制转换/中文数字</h3><h4 id="大写数字" tabindex="-1"><a class="header-anchor" href="#大写数字" aria-hidden="true">#</a> 大写数字</h4><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token class-name"><span class="token keyword">var</span></span> num<span class="token operator">=</span><span class="token number">123.45</span><span class="token punctuation">.</span><span class="token function">ToChineseMoney</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 壹佰贰拾叁元肆角伍分</span>
<span class="token class-name"><span class="token keyword">var</span></span> num<span class="token operator">=</span><span class="token number">123.45</span><span class="token punctuation">.</span><span class="token function">ToChineseNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 一百二十三点四五</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="进制转换" tabindex="-1"><a class="header-anchor" href="#进制转换" aria-hidden="true">#</a> 进制转换</h4><p>可用于生成短id，短hash，随机字符串等操作，纯数学运算。</p><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token class-name">NumberFormater</span> nf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">NumberFormater</span><span class="token punctuation">(</span><span class="token number">36</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//内置2-91进制的转换</span>
<span class="token comment">//NumberFormater nf = new NumberFormater(&quot;0123456789abcdefghijklmnopqrstuvwxyz&quot;);// 自定义进制字符，可用于生成验证码，自定义字符可支持任意进制，你传1w个字符进去那就支持一万进制(手动狗头)</span>
<span class="token class-name"><span class="token keyword">string</span></span> s36 <span class="token operator">=</span> nf<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token number">12345678</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">long</span></span> num <span class="token operator">=</span> nf<span class="token punctuation">.</span><span class="token function">FromString</span><span class="token punctuation">(</span><span class="token string">&quot;7clzi&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;12345678的36进制是：&quot;</span> <span class="token operator">+</span> s36<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 7clzi</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;36进制的7clzi是：&quot;</span> <span class="token operator">+</span> num<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 12345678</span>
<span class="token class-name"><span class="token keyword">var</span></span> s <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">NumberFormater</span><span class="token punctuation">(</span><span class="token number">91</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Next</span><span class="token punctuation">(</span><span class="token number">100000</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">.</span>MaxValue<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//配合随机数生成随机字符串</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token comment">//扩展方法形式调用</span>
<span class="token class-name"><span class="token keyword">var</span></span> bin<span class="token operator">=</span><span class="token number">12345678</span><span class="token punctuation">.</span><span class="token function">ToBase</span><span class="token punctuation">(</span><span class="token number">36</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 10进制转36进制：7clzi</span>
<span class="token class-name"><span class="token keyword">var</span></span> num<span class="token operator">=</span><span class="token string">&quot;7clzi&quot;</span><span class="token punctuation">.</span><span class="token function">FromBase</span><span class="token punctuation">(</span><span class="token number">36</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 36进制转10进制：12345678</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token comment">//超大数字的进制转换</span>
<span class="token class-name"><span class="token keyword">var</span></span> num <span class="token operator">=</span> <span class="token string">&quot;e6186159d38cd50e0463a55e596336bd&quot;</span><span class="token punctuation">.</span><span class="token function">FromBaseBig</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 大数字16进制转10进制</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 十进制：305849028665645097422198928560410015421</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>num<span class="token punctuation">.</span><span class="token function">ToBase</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 64进制：3C665pQUPl3whzFlVpoPqZ，22位长度</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>num<span class="token punctuation">.</span><span class="token function">ToBase</span><span class="token punctuation">(</span><span class="token number">36</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 36进制：dmed4dkd5bhcg4qdktklun0zh，25位长度</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>num<span class="token punctuation">.</span><span class="token function">ToBase</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 7进制：2600240311641665565300424545154525131265221035，46位长度</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>num<span class="token punctuation">.</span><span class="token function">ToBase</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 12进制：5217744842749978a756b22135b16a5998a5，36位长度</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>num<span class="token punctuation">.</span><span class="token function">ToBase</span><span class="token punctuation">(</span><span class="token number">41</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 41进制：opzeBda2aytcEeudEquuesbk，24位长度</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果你想让进制符支持emoji，NumberFormater是不支持的，不过如果你确实有这么骚的需求，我还准备了UnicodeFormater类，用于支持emoji，用法和NumberFormater一模一样，并且，UnicodeFormater的功能包含NumberFormater的功能，但是，性能比NumberFormater差了许多。</p><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token class-name"><span class="token keyword">var</span></span> formater <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">UnicodeFormater</span><span class="token punctuation">(</span><span class="token string">&quot;😀😁😂🤣😃😄😅😆😉😊😋😎😍😘🥰😗😙🥲😚🙂🤗🤩🤔🤨😑😶😶‍🌫🙄😏😣😥😮&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> s <span class="token operator">=</span> formater<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token number">1234567890</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 😄🌫😶😋😋</span>
<span class="token class-name"><span class="token keyword">var</span></span> num <span class="token operator">=</span> formater<span class="token punctuation">.</span><span class="token function">FromString</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1234567890</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6-纳秒级性能计时器" tabindex="-1"><a class="header-anchor" href="#_6-纳秒级性能计时器" aria-hidden="true">#</a> 6.纳秒级性能计时器</h3><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token class-name">HiPerfTimer</span> timer <span class="token operator">=</span> HiPerfTimer<span class="token punctuation">.</span><span class="token function">StartNew</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">//todo</span>
<span class="token punctuation">}</span>
timer<span class="token punctuation">.</span><span class="token function">Stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;执行for循环100000次耗时&quot;</span><span class="token operator">+</span>timer<span class="token punctuation">.</span>Duration<span class="token operator">+</span><span class="token string">&quot;s&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token class-name"><span class="token keyword">double</span></span> time <span class="token operator">=</span> HiPerfTimer<span class="token punctuation">.</span><span class="token function">Execute</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
<span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">//todo</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;执行for循环100000次耗时&quot;</span><span class="token operator">+</span>time<span class="token operator">+</span><span class="token string">&quot;s&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_7-产生分布式唯一有序短id-雪花id" tabindex="-1"><a class="header-anchor" href="#_7-产生分布式唯一有序短id-雪花id" aria-hidden="true">#</a> 7.产生分布式唯一有序短id(雪花id)</h3><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token class-name"><span class="token keyword">var</span></span> sf <span class="token operator">=</span> SnowFlake<span class="token punctuation">.</span><span class="token function">GetInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">string</span></span> token <span class="token operator">=</span> sf<span class="token punctuation">.</span><span class="token function">GetUniqueId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// rcofqodori0w</span>
<span class="token class-name"><span class="token keyword">string</span></span> token <span class="token operator">=</span> SnowFlake<span class="token punctuation">.</span>NewId<span class="token punctuation">;</span><span class="token comment">// rcofqodori0w</span>
<span class="token class-name"><span class="token keyword">string</span></span> shortId <span class="token operator">=</span> sf<span class="token punctuation">.</span><span class="token function">GetUniqueShortId</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// qodw9728</span>
<span class="token class-name"><span class="token keyword">string</span></span> token <span class="token operator">=</span> SnowFlakeNew<span class="token punctuation">.</span>NewId<span class="token punctuation">;</span><span class="token comment">// 改良版雪花id，对时间回拨不敏感</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token class-name"><span class="token keyword">var</span></span> <span class="token keyword">set</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">HashSet<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">double</span></span> time <span class="token operator">=</span> HiPerfTimer<span class="token punctuation">.</span><span class="token function">Execute</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
<span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">1000000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">set</span><span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>SnowFlake<span class="token punctuation">.</span>NewId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token keyword">set</span><span class="token punctuation">.</span>Count <span class="token operator">==</span> <span class="token number">1000000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//True</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;产生100w个id耗时&quot;</span> <span class="token operator">+</span> time <span class="token operator">+</span> <span class="token string">&quot;s&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//2.6891495s</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_8-农历转换" tabindex="-1"><a class="header-anchor" href="#_8-农历转换" aria-hidden="true">#</a> 8.农历转换</h3><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code>ChineseCalendar<span class="token punctuation">.</span>CustomHolidays<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>DateTime<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span><span class="token string">&quot;2018-12-31&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;元旦节&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//自定义节假日</span>
<span class="token class-name">ChineseCalendar</span> today <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ChineseCalendar</span><span class="token punctuation">(</span>DateTime<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span><span class="token string">&quot;2018-12-31&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>today<span class="token punctuation">.</span>ChineseDateString<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 二零一八年十一月廿五</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>today<span class="token punctuation">.</span>AnimalString<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 生肖：狗</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>today<span class="token punctuation">.</span>GanZhiDateString<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 干支：戊戌年甲子月丁酉日</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>today<span class="token punctuation">.</span>DateHoliday<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 获取按公历计算的节假日</span>
<span class="token range operator">..</span><span class="token punctuation">.</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_9-linq表达式树扩展" tabindex="-1"><a class="header-anchor" href="#_9-linq表达式树扩展" aria-hidden="true">#</a> 9.Linq表达式树扩展</h3><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token class-name">Expression<span class="token punctuation">&lt;</span>Func<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> <span class="token keyword">bool</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> where1 <span class="token operator">=</span> s <span class="token operator">=&gt;</span> s<span class="token punctuation">.</span><span class="token function">StartsWith</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Expression<span class="token punctuation">&lt;</span>Func<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> <span class="token keyword">bool</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> where2 <span class="token operator">=</span> s <span class="token operator">=&gt;</span> s<span class="token punctuation">.</span>Length <span class="token operator">&gt;</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token class-name">Func<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> <span class="token keyword">bool</span><span class="token punctuation">&gt;</span></span> func <span class="token operator">=</span> where1<span class="token punctuation">.</span><span class="token function">And</span><span class="token punctuation">(</span>where2<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">AndIf</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">IsNullOrEmpty</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">,</span>s<span class="token operator">=&gt;</span>s<span class="token operator">==</span>name<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">Compile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// And和AndIf可供选择，满足条件再执行And</span>
<span class="token class-name"><span class="token keyword">bool</span></span> b<span class="token operator">=</span><span class="token function">func</span><span class="token punctuation">(</span><span class="token string">&quot;abcd12345678&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//true</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token class-name">Expression<span class="token punctuation">&lt;</span>Func<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> <span class="token keyword">bool</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> where1 <span class="token operator">=</span> s <span class="token operator">=&gt;</span> s<span class="token punctuation">.</span><span class="token function">StartsWith</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Expression<span class="token punctuation">&lt;</span>Func<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> <span class="token keyword">bool</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> where2 <span class="token operator">=</span> s <span class="token operator">=&gt;</span> s<span class="token punctuation">.</span>Length <span class="token operator">&gt;</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token class-name">Func<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> <span class="token keyword">bool</span><span class="token punctuation">&gt;</span></span> func <span class="token operator">=</span> where1
    <span class="token punctuation">.</span><span class="token function">Or</span><span class="token punctuation">(</span>where2<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">OrIf</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">IsNullOrEmpty</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">,</span>s<span class="token operator">=&gt;</span>s<span class="token operator">==</span>name<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">Compile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Or和OrIf可供选择，满足条件再执行Or</span>
<span class="token class-name"><span class="token keyword">bool</span></span> b<span class="token operator">=</span><span class="token function">func</span><span class="token punctuation">(</span><span class="token string">&quot;abc&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// true</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code>queryable<span class="token punctuation">.</span><span class="token function">WhereIf</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">IsNullOrEmpty</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">,</span>e<span class="token operator">=&gt;</span>e<span class="token punctuation">.</span>Name<span class="token operator">==</span>name<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">WhereIf</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> age<span class="token punctuation">.</span>HasValue<span class="token punctuation">,</span>e<span class="token operator">=&gt;</span>e<span class="token punctuation">.</span>Age<span class="token operator">&gt;=</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// IQueryable的WhereIf扩展函数，满足条件再执行Where</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_10-模版引擎" tabindex="-1"><a class="header-anchor" href="#_10-模版引擎" aria-hidden="true">#</a> 10.模版引擎</h3><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token class-name"><span class="token keyword">var</span></span> tmp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Template</span><span class="token punctuation">(</span><span class="token string">&quot;{{name}}，你好！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
tmp<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;万金油&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">string</span></span> s <span class="token operator">=</span> tmp<span class="token punctuation">.</span><span class="token function">Render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//万金油，你好！</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token class-name"><span class="token keyword">var</span></span> tmp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Template</span><span class="token punctuation">(</span><span class="token string">&quot;{{one}},{{two}},{{three}}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">string</span></span> s <span class="token operator">=</span> tmp<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">&quot;one&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">&quot;two&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">&quot;three&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 1,2,3</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token class-name"><span class="token keyword">var</span></span> tmp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Template</span><span class="token punctuation">(</span><span class="token string">&quot;{{name}}，{{greet}}！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
tmp<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;万金油&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">string</span></span> s <span class="token operator">=</span> tmp<span class="token punctuation">.</span><span class="token function">Render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// throw 模版变量{{greet}}未被使用</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_11-list转datatable" tabindex="-1"><a class="header-anchor" href="#_11-list转datatable" aria-hidden="true">#</a> 11.List转Datatable</h3><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token class-name"><span class="token keyword">var</span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">List<span class="token punctuation">&lt;</span>MyClass<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MyClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Name <span class="token operator">=</span> <span class="token string">&quot;张三&quot;</span><span class="token punctuation">,</span>
        Age <span class="token operator">=</span> <span class="token number">22</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MyClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Name <span class="token operator">=</span> <span class="token string">&quot;李四&quot;</span><span class="token punctuation">,</span>
        Age <span class="token operator">=</span> <span class="token number">21</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MyClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Name <span class="token operator">=</span> <span class="token string">&quot;王五&quot;</span><span class="token punctuation">,</span>
        Age <span class="token operator">=</span> <span class="token number">28</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> table <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span>c <span class="token operator">=&gt;</span> <span class="token keyword">new</span><span class="token punctuation">{</span>姓名<span class="token operator">=</span>c<span class="token punctuation">.</span>Name<span class="token punctuation">,</span>年龄<span class="token operator">=</span>c<span class="token punctuation">.</span>Age<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToDataTable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 将自动填充列姓名和年龄</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_12-文件压缩解压" tabindex="-1"><a class="header-anchor" href="#_12-文件压缩解压" aria-hidden="true">#</a> 12.文件压缩解压</h3><p>.NET Framework</p><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token class-name">MemoryStream</span> ms <span class="token operator">=</span> SevenZipCompressor<span class="token punctuation">.</span><span class="token function">ZipStream</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">List<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token string">@&quot;D:\1.txt&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;http://ww3.sinaimg.cn/large/87c01ec7gy1fsq6rywto2j20je0d3td0.jpg&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//压缩成内存流</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code>SevenZipCompressor<span class="token punctuation">.</span><span class="token function">Zip</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">List<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token string">@&quot;D:\1.txt&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;http://ww3.sinaimg.cn/large/87c01ec7gy1fsq6rywto2j20je0d3td0.jpg&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> zip<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//压缩成zip</span>
SevenZipCompressor<span class="token punctuation">.</span><span class="token function">UnRar</span><span class="token punctuation">(</span><span class="token string">@&quot;D:\Download\test.rar&quot;</span><span class="token punctuation">,</span> <span class="token string">@&quot;D:\Download\&quot;);//解压rar
SevenZipCompressor.Decompress(@&quot;</span>D<span class="token punctuation">:</span>\Download\test<span class="token punctuation">.</span>tar<span class="token string">&quot;, @&quot;</span>D<span class="token punctuation">:</span>\Download\&quot;<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//自动识别解压压缩包</span>
SevenZipCompressor<span class="token punctuation">.</span><span class="token function">Decompress</span><span class="token punctuation">(</span><span class="token string">@&quot;D:\Download\test.7z&quot;</span><span class="token punctuation">,</span> @&quot;D<span class="token punctuation">:</span>\Download\&quot;<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ASP.NET Core</p><p>Startup.cs</p><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code>services<span class="token punctuation">.</span><span class="token function">AddSevenZipCompressor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>构造函数注入ISevenZipCompressor</p><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">ISevenZipCompressor</span> _sevenZipCompressor<span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token function">Test</span><span class="token punctuation">(</span><span class="token class-name">ISevenZipCompressor</span> sevenZipCompressor<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    _sevenZipCompressor <span class="token operator">=</span> sevenZipCompressor<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>使用方式同.NET Framework版本</p><h3 id="_13-简易日志组件-又不是不能用-jpg" tabindex="-1"><a class="header-anchor" href="#_13-简易日志组件-又不是不能用-jpg" aria-hidden="true">#</a> 13.简易日志组件(又不是不能用.jpg)</h3><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code>LogManager<span class="token punctuation">.</span>LogDirectory<span class="token operator">=</span>AppDomain<span class="token punctuation">.</span>CurrentDomain<span class="token punctuation">.</span>BaseDirectory<span class="token operator">+</span><span class="token string">&quot;/logs&quot;</span><span class="token punctuation">;</span>
LogManager<span class="token punctuation">.</span>Event<span class="token operator">+=</span>info <span class="token operator">=&gt;</span>
<span class="token punctuation">{</span>
    <span class="token comment">//todo:注册一些事件操作</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
LogManager<span class="token punctuation">.</span><span class="token function">Info</span><span class="token punctuation">(</span><span class="token string">&quot;记录一次消息&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
LogManager<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Exception</span><span class="token punctuation">(</span><span class="token string">&quot;异常消息&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_14-多线程后台下载" tabindex="-1"><a class="header-anchor" href="#_14-多线程后台下载" aria-hidden="true">#</a> 14.多线程后台下载</h3><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token class-name"><span class="token keyword">var</span></span> mtd <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MultiThreadDownloader</span><span class="token punctuation">(</span><span class="token string">&quot;https://attachments-cdn.shimo.im/yXwC4kphjVQu06rH/KeyShot_Pro_7.3.37.7z&quot;</span><span class="token punctuation">,</span>Environment<span class="token punctuation">.</span><span class="token function">GetEnvironmentVariable</span><span class="token punctuation">(</span><span class="token string">&quot;temp&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;E:\\Downloads\\KeyShot_Pro_7.3.37.7z&quot;</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
mtd<span class="token punctuation">.</span><span class="token function">Configure</span><span class="token punctuation">(</span>req <span class="token operator">=&gt;</span>
 <span class="token punctuation">{</span>
     req<span class="token punctuation">.</span>Referer <span class="token operator">=</span> <span class="token string">&quot;https://masuit.com&quot;</span><span class="token punctuation">;</span>
     req<span class="token punctuation">.</span>Headers<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">&quot;Origin&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;https://baidu.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
mtd<span class="token punctuation">.</span>TotalProgressChanged<span class="token operator">+=</span><span class="token punctuation">(</span>sender<span class="token punctuation">,</span> e<span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">var</span></span> downloader <span class="token operator">=</span> sender <span class="token keyword">as</span> <span class="token class-name">MultiThreadDownloader</span><span class="token punctuation">;</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;下载进度：&quot;</span><span class="token operator">+</span>downloader<span class="token punctuation">.</span>TotalProgress<span class="token operator">+</span><span class="token string">&quot;%&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;下载速度：&quot;</span><span class="token operator">+</span>downloader<span class="token punctuation">.</span>TotalSpeedInBytes<span class="token operator">/</span><span class="token number">1024</span><span class="token operator">/</span><span class="token number">1024</span><span class="token operator">+</span><span class="token string">&quot;MBps&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
mtd<span class="token punctuation">.</span>FileMergeProgressChanged<span class="token operator">+=</span><span class="token punctuation">(</span>sender<span class="token punctuation">,</span> e<span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
<span class="token punctuation">{</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;下载完成&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
mtd<span class="token punctuation">.</span>FileMergedComplete<span class="token operator">+=</span><span class="token punctuation">(</span>sender<span class="token punctuation">,</span>e<span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;文件合并完成&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
mtd<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//开始下载</span>
<span class="token comment">//mtd.Pause(); // 暂停下载</span>
<span class="token comment">//mtd.Resume(); // 继续下载</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_15-加密解密-hash" tabindex="-1"><a class="header-anchor" href="#_15-加密解密-hash" aria-hidden="true">#</a> 15.加密解密/hash</h3><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token class-name"><span class="token keyword">var</span></span> enc<span class="token operator">=</span><span class="token string">&quot;123456&quot;</span><span class="token punctuation">.</span><span class="token function">MDString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// MD5</span>
<span class="token class-name"><span class="token keyword">var</span></span> enc<span class="token operator">=</span><span class="token string">&quot;123456&quot;</span><span class="token punctuation">.</span><span class="token function">MDString</span><span class="token punctuation">(</span><span class="token string">&quot;abc&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// MD5加盐</span>
<span class="token class-name"><span class="token keyword">var</span></span> enc<span class="token operator">=</span><span class="token string">&quot;123456&quot;</span><span class="token punctuation">.</span><span class="token function">MDString2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// MD5两次</span>
<span class="token class-name"><span class="token keyword">var</span></span> enc<span class="token operator">=</span><span class="token string">&quot;123456&quot;</span><span class="token punctuation">.</span><span class="token function">MDString2</span><span class="token punctuation">(</span><span class="token string">&quot;abc&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// MD5两次加盐</span>
<span class="token class-name"><span class="token keyword">var</span></span> enc<span class="token operator">=</span><span class="token string">&quot;123456&quot;</span><span class="token punctuation">.</span><span class="token function">MDString3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// MD5三次</span>
<span class="token class-name"><span class="token keyword">var</span></span> enc<span class="token operator">=</span><span class="token string">&quot;123456&quot;</span><span class="token punctuation">.</span><span class="token function">MDString3</span><span class="token punctuation">(</span><span class="token string">&quot;abc&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// MD5三次加盐</span>

<span class="token class-name"><span class="token keyword">string</span></span> aes <span class="token operator">=</span> <span class="token string">&quot;123456&quot;</span><span class="token punctuation">.</span><span class="token function">AESEncrypt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// AES加密为密文</span>
<span class="token class-name"><span class="token keyword">string</span></span> s <span class="token operator">=</span> aes<span class="token punctuation">.</span><span class="token function">AESDecrypt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//AES解密为明文</span>
<span class="token class-name"><span class="token keyword">string</span></span> aes <span class="token operator">=</span> <span class="token string">&quot;123456&quot;</span><span class="token punctuation">.</span><span class="token function">AESEncrypt</span><span class="token punctuation">(</span><span class="token string">&quot;abc&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// AES密钥加密为密文</span>
<span class="token class-name"><span class="token keyword">string</span></span> s <span class="token operator">=</span> aes<span class="token punctuation">.</span><span class="token function">AESDecrypt</span><span class="token punctuation">(</span><span class="token string">&quot;abc&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//AES密钥解密为明文</span>

<span class="token class-name"><span class="token keyword">string</span></span> enc <span class="token operator">=</span> <span class="token string">&quot;123456&quot;</span><span class="token punctuation">.</span><span class="token function">DesEncrypt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// DES加密为密文</span>
<span class="token class-name"><span class="token keyword">string</span></span> s <span class="token operator">=</span> enc<span class="token punctuation">.</span><span class="token function">DesDecrypt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//DES解密为明文</span>
<span class="token class-name"><span class="token keyword">string</span></span> enc <span class="token operator">=</span> <span class="token string">&quot;123456&quot;</span><span class="token punctuation">.</span><span class="token function">DesEncrypt</span><span class="token punctuation">(</span><span class="token string">&quot;abcdefgh&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// DES密钥加密为密文</span>
<span class="token class-name"><span class="token keyword">string</span></span> s <span class="token operator">=</span> enc<span class="token punctuation">.</span><span class="token function">DesDecrypt</span><span class="token punctuation">(</span><span class="token string">&quot;abcdefgh&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//DES密钥解密为明文</span>

<span class="token class-name">RsaKey</span> rsaKey <span class="token operator">=</span> RsaCrypt<span class="token punctuation">.</span><span class="token function">GenerateRsaKeys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 生成RSA密钥对</span>
<span class="token class-name"><span class="token keyword">string</span></span> encrypt <span class="token operator">=</span> <span class="token string">&quot;123456&quot;</span><span class="token punctuation">.</span><span class="token function">RSAEncrypt</span><span class="token punctuation">(</span>rsaKey<span class="token punctuation">.</span>PublicKey<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 公钥加密</span>
<span class="token class-name"><span class="token keyword">string</span></span> s <span class="token operator">=</span> encrypt<span class="token punctuation">.</span><span class="token function">RSADecrypt</span><span class="token punctuation">(</span>rsaKey<span class="token punctuation">.</span>PrivateKey<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 私钥解密</span>

<span class="token class-name"><span class="token keyword">string</span></span> s <span class="token operator">=</span> <span class="token string">&quot;123&quot;</span><span class="token punctuation">.</span><span class="token function">Crc32</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 生成crc32摘要</span>
<span class="token class-name"><span class="token keyword">string</span></span> s <span class="token operator">=</span> <span class="token string">&quot;123&quot;</span><span class="token punctuation">.</span><span class="token function">Crc64</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 生成crc64摘要</span>
<span class="token class-name"><span class="token keyword">string</span></span> s <span class="token operator">=</span> <span class="token string">&quot;123&quot;</span><span class="token punctuation">.</span><span class="token function">SHA256</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 生成SHA256摘要</span>

<span class="token comment">// 零宽字符串，通常用作文章水印，以一种看不见的字符插入到文本中，使攻击者无法直接识别文本内容，从而起到保护文章的作用。</span>
<span class="token class-name"><span class="token keyword">string</span></span> pub<span class="token operator">=</span><span class="token string">&quot;hello,world!&quot;</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">string</span></span> hidden<span class="token operator">=</span><span class="token string">&quot;ldqk&quot;</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> str <span class="token operator">=</span> pub<span class="token punctuation">.</span><span class="token function">InjectZeroWidthString</span><span class="token punctuation">(</span>hidden<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 扩展函数调用：将&quot;ldqk&quot;以零宽字符串的方式隐藏在&quot;hello,world!&quot;中</span>
<span class="token class-name"><span class="token keyword">var</span></span> str <span class="token operator">=</span> ZeroWidthCodec<span class="token punctuation">.</span><span class="token function">Encrypt</span><span class="token punctuation">(</span>pub<span class="token punctuation">,</span>hidden<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 类调用：将&quot;ldqk&quot;以零宽字符串的方式隐藏在&quot;hello,world!&quot;中</span>
<span class="token class-name"><span class="token keyword">var</span></span> dec <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">DecodeZeroWidthString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 扩展函数调用：将包含零宽字符串的密文解密出隐藏字符串&quot;ldqk&quot;</span>
<span class="token class-name"><span class="token keyword">var</span></span> dec <span class="token operator">=</span> ZeroWidthCodec<span class="token punctuation">.</span><span class="token function">Decrypt</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 类调用：将包含零宽字符串的密文解密出隐藏字符串&quot;ldqk&quot;</span>
<span class="token class-name"><span class="token keyword">var</span></span> enc <span class="token operator">=</span> hidden<span class="token punctuation">.</span><span class="token function">EncodeToZeroWidthText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 扩展函数调用：将字符串编码成零宽字符串</span>
<span class="token class-name"><span class="token keyword">var</span></span> enc <span class="token operator">=</span> ZeroWidthCodec<span class="token punctuation">.</span><span class="token function">Encode</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 类调用：将字符串编码成零宽字符串</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_16-实体校验" tabindex="-1"><a class="header-anchor" href="#_16-实体校验" aria-hidden="true">#</a> 16.实体校验</h3><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyClass</span>
<span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">IsEmail</span></span><span class="token punctuation">]</span> <span class="token comment">//可在appsetting.json中添加EmailDomainWhiteList配置邮箱域名白名单，逗号分隔</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Email <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">IsPhone</span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> PhoneNumber <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">IsLandline</span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Landline <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">IsIPAddress</span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> IP <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">MinValue</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> ErrorMessage <span class="token operator">=</span> <span class="token string">&quot;年龄最小为0岁&quot;</span><span class="token punctuation">)</span></span><span class="token punctuation">,</span> <span class="token class-name">MaxValue</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> ErrorMessage <span class="token operator">=</span> <span class="token string">&quot;年龄最大100岁&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> Age <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">ComplexPassword</span></span><span class="token punctuation">]</span><span class="token comment">//密码复杂度校验</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Password <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
  
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">EnumOf</span></span><span class="token punctuation">]</span> <span class="token comment">// 检测是否是有效枚举值</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">MyEnum</span> MyEnum <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
  
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">MinItemsCount</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span> <span class="token comment">// 检测集合元素最少1个</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">List<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span> Strs <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_17-html操作" tabindex="-1"><a class="header-anchor" href="#_17-html操作" aria-hidden="true">#</a> 17.HTML操作</h3><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token class-name">List<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span> srcs <span class="token operator">=</span> <span class="token string">&quot;html&quot;</span><span class="token punctuation">.</span><span class="token function">MatchImgSrcs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 获取html字符串里所有的img标签的src属性</span>
<span class="token class-name"><span class="token keyword">var</span></span> imgTags <span class="token operator">=</span> <span class="token string">&quot;html&quot;</span><span class="token punctuation">.</span><span class="token function">MatchImgTags</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//获取html字符串里的所有的img标签</span>
<span class="token class-name"><span class="token keyword">var</span></span> str<span class="token operator">=</span><span class="token string">&quot;html&quot;</span><span class="token punctuation">.</span><span class="token function">RemoveHtmlTag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 去除html标签</span>
<span class="token range operator">..</span><span class="token punctuation">.</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_18-ip地址和url" tabindex="-1"><a class="header-anchor" href="#_18-ip地址和url" aria-hidden="true">#</a> 18.IP地址和URL</h3><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token class-name"><span class="token keyword">bool</span></span> inRange <span class="token operator">=</span> <span class="token string">&quot;192.168.2.2&quot;</span><span class="token punctuation">.</span><span class="token function">IpAddressInRange</span><span class="token punctuation">(</span><span class="token string">&quot;192.168.1.1&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;192.168.3.255&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 判断IP地址是否在这个地址段里</span>
<span class="token class-name"><span class="token keyword">bool</span></span> isPrivateIp <span class="token operator">=</span> <span class="token string">&quot;172.16.23.25&quot;</span><span class="token punctuation">.</span><span class="token function">IsPrivateIP</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 判断是否是私有地址</span>
<span class="token class-name"><span class="token keyword">bool</span></span> isExternalAddress <span class="token operator">=</span> <span class="token string">&quot;http://baidu.com&quot;</span><span class="token punctuation">.</span><span class="token function">IsExternalAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 判断是否是外网的URL</span>

<span class="token comment">//以下需要配置baiduAK</span>
<span class="token class-name"><span class="token keyword">string</span></span> isp <span class="token operator">=</span> <span class="token string">&quot;114.114.114.114&quot;</span><span class="token punctuation">.</span><span class="token function">GetISP</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获取ISP运营商信息</span>
<span class="token class-name">PhysicsAddress</span> physicsAddress <span class="token operator">=</span> <span class="token string">&quot;114.114.114.114&quot;</span><span class="token punctuation">.</span><span class="token function">GetPhysicsAddressInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Result<span class="token punctuation">;</span><span class="token comment">// 获取详细地理信息对象</span>
<span class="token class-name">Tuple<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> List<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> ipAddressInfo <span class="token operator">=</span> <span class="token string">&quot;114.114.114.114&quot;</span><span class="token punctuation">.</span><span class="token function">GetIPAddressInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Result<span class="token punctuation">;</span><span class="token comment">// 获取详细地理信息集合</span>

<span class="token class-name"><span class="token keyword">uint</span></span> number<span class="token operator">=</span>ipAddress<span class="token punctuation">.</span><span class="token function">ToUInt32</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// IP地址转10进制</span>
<span class="token class-name"><span class="token keyword">uint</span></span> number<span class="token operator">=</span><span class="token string">&quot;114.114.114.114&quot;</span><span class="token punctuation">.</span><span class="token function">IPToID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// IP地址转10进制</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_19-对象属性值合并" tabindex="-1"><a class="header-anchor" href="#_19-对象属性值合并" aria-hidden="true">#</a> 19.对象属性值合并</h3><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyClass</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> A <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span><span class="token punctuation">?</span></span> B <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span><span class="token punctuation">?</span></span> C <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token class-name"><span class="token keyword">var</span></span> a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MyClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    A <span class="token operator">=</span> <span class="token string">&quot;aa&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> b <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MyClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    B <span class="token operator">=</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> c <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MyClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    C <span class="token operator">=</span> <span class="token number">3</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> merge <span class="token operator">=</span> a<span class="token punctuation">.</span><span class="token function">Merge</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 合并后对象：A = &quot;aa&quot;，B = true，C = 3</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_20-元素去重" tabindex="-1"><a class="header-anchor" href="#_20-元素去重" aria-hidden="true">#</a> 20.元素去重</h3><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token class-name"><span class="token keyword">var</span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">List<span class="token punctuation">&lt;</span>MyClass<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MyClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Email <span class="token operator">=</span> <span class="token string">&quot;1@1.cn&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MyClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Email <span class="token operator">=</span> <span class="token string">&quot;1@1.cn&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MyClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Email <span class="token operator">=</span> <span class="token string">&quot;1@1.cn&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token class-name">List<span class="token punctuation">&lt;</span>MyClass<span class="token punctuation">&gt;</span></span> classes <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">DistinctBy</span><span class="token punctuation">(</span>c <span class="token operator">=&gt;</span> c<span class="token punctuation">.</span>Email<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>classes<span class="token punctuation">.</span>Count<span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//True</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_21-枚举扩展" tabindex="-1"><a class="header-anchor" href="#_21-枚举扩展" aria-hidden="true">#</a> 21.枚举扩展</h3><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Flags</span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">MyEnum</span>
<span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Display</span><span class="token attribute-arguments"><span class="token punctuation">(</span>Name <span class="token operator">=</span> <span class="token string">&quot;读&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Description</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;读&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">EnumDescription</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;读取操作&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;读&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;zh-CN&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span> <span class="token comment">// 多语言枚举描述</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">EnumDescription</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;Read&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;Read&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;en-US&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    Read<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>
  
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Display</span><span class="token attribute-arguments"><span class="token punctuation">(</span>Name <span class="token operator">=</span> <span class="token string">&quot;写&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Description</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;写&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    Write<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>

    Delete<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span>

    All<span class="token operator">=</span><span class="token number">8</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token class-name">Dictionary<span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">string</span><span class="token punctuation">&gt;</span></span> dic1 <span class="token operator">=</span> <span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">MyEnum</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">GetDictionary</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 获取枚举值和字符串表示的字典映射</span>
<span class="token class-name"><span class="token keyword">var</span></span> dic2 <span class="token operator">=</span> <span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">MyEnum</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">GetDescriptionAndValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 获取字符串表示和枚举值的字典映射</span>
<span class="token class-name"><span class="token keyword">string</span></span> desc <span class="token operator">=</span> MyEnum<span class="token punctuation">.</span>Read<span class="token punctuation">.</span><span class="token function">GetDescription</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 获取Description标签</span>
<span class="token class-name"><span class="token keyword">string</span></span> display <span class="token operator">=</span> MyEnum<span class="token punctuation">.</span>Read<span class="token punctuation">.</span><span class="token function">GetDisplay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 获取Display标签的Name属性</span>
<span class="token class-name"><span class="token keyword">var</span></span> <span class="token keyword">value</span> <span class="token operator">=</span> <span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">MyEnum</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">GetValue</span><span class="token punctuation">(</span><span class="token string">&quot;Read&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//获取字符串表示值对应的枚举值</span>
<span class="token class-name"><span class="token keyword">string</span></span> enumString <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">.</span><span class="token function">ToEnumString</span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">MyEnum</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 获取枚举值对应的字符串表示</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token class-name"><span class="token keyword">var</span></span> op<span class="token operator">=</span>MyEnum<span class="token punctuation">.</span>Read<span class="token operator">|</span>MyEnum<span class="token punctuation">.</span>Write<span class="token operator">|</span>MyEnum<span class="token punctuation">.</span>Delete<span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> enums<span class="token operator">=</span>op<span class="token punctuation">.</span><span class="token function">Split</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 拆分枚举值，得到枚举数组，这个函数建议使用在按位定值的枚举</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_22-定长队列和concurrenthashset实现" tabindex="-1"><a class="header-anchor" href="#_22-定长队列和concurrenthashset实现" aria-hidden="true">#</a> 22.定长队列和ConcurrentHashSet实现</h3><p><code>如果是.NET5及以上，推荐使用框架自带的Channel实现该功能</code></p><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token class-name">LimitedQueue<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span> queue <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">LimitedQueue<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 声明一个容量为32个元素的定长队列</span>
<span class="token class-name">ConcurrentLimitedQueue<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span> queue <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ConcurrentLimitedQueue<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 声明一个容量为32个元素的线程安全的定长队列</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token class-name"><span class="token keyword">var</span></span> <span class="token keyword">set</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ConcurrentHashSet<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 用法和hashset保持一致</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_23-反射操作" tabindex="-1"><a class="header-anchor" href="#_23-反射操作" aria-hidden="true">#</a> 23.反射操作</h3><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token class-name">MyClass</span> myClass <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MyClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">PropertyInfo<span class="token punctuation">[</span><span class="token punctuation">]</span></span> properties <span class="token operator">=</span> myClass<span class="token punctuation">.</span><span class="token function">GetProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 获取属性列表</span>
myClass<span class="token punctuation">.</span><span class="token function">SetProperty</span><span class="token punctuation">(</span><span class="token string">&quot;Email&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;1@1.cn&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//给对象设置值</span>
myClass<span class="token punctuation">.</span><span class="token function">DeepClone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 对象深拷贝，带嵌套层级的</span>
myClass<span class="token punctuation">.</span><span class="token function">ToDictionary</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 对象转字典</span>
myClass<span class="token punctuation">.</span><span class="token function">ToDynamic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 对象转换成动态可扩展类型</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_24-邮件发送" tabindex="-1"><a class="header-anchor" href="#_24-邮件发送" aria-hidden="true">#</a> 24.邮件发送</h3><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Email</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    SmtpServer <span class="token operator">=</span> <span class="token string">&quot;smtp.masuit.com&quot;</span><span class="token punctuation">,</span><span class="token comment">// SMTP服务器</span>
    SmtpPort <span class="token operator">=</span> <span class="token number">25</span><span class="token punctuation">,</span> <span class="token comment">// SMTP服务器端口</span>
    EnableSsl <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span><span class="token comment">//使用SSL</span>
    Username <span class="token operator">=</span> <span class="token string">&quot;admin@masuit.com&quot;</span><span class="token punctuation">,</span><span class="token comment">// 邮箱用户名</span>
    Password <span class="token operator">=</span> <span class="token string">&quot;123456&quot;</span><span class="token punctuation">,</span><span class="token comment">// 邮箱密码</span>
    Tos <span class="token operator">=</span> <span class="token string">&quot;10000@qq.com,10001@qq.com&quot;</span><span class="token punctuation">,</span> <span class="token comment">//收件人</span>
    Subject <span class="token operator">=</span> <span class="token string">&quot;测试邮件&quot;</span><span class="token punctuation">,</span><span class="token comment">//邮件标题</span>
    Body <span class="token operator">=</span> <span class="token string">&quot;你好啊&quot;</span><span class="token punctuation">,</span><span class="token comment">//邮件内容</span>
<span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">SendAsync</span><span class="token punctuation">(</span>s <span class="token operator">=&gt;</span>
<span class="token punctuation">{</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 发送成功后的回调</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 异步发送邮件</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_25-图像的简单处理" tabindex="-1"><a class="header-anchor" href="#_25-图像的简单处理" aria-hidden="true">#</a> 25.图像的简单处理</h3><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code>ImageUtilities<span class="token punctuation">.</span><span class="token function">CompressImage</span><span class="token punctuation">(</span><span class="token string">@&quot;F:\src\1.jpg&quot;</span><span class="token punctuation">,</span> <span class="token string">@&quot;F:\dest\2.jpg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//无损压缩图片</span>

<span class="token string">&quot;base64&quot;</span><span class="token punctuation">.</span><span class="token function">SaveDataUriAsImageFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 将Base64编码转换成图片</span>

<span class="token class-name">Image</span> image <span class="token operator">=</span> Image<span class="token punctuation">.</span><span class="token function">FromFile</span><span class="token punctuation">(</span><span class="token string">@&quot;D:\1.jpg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
image<span class="token punctuation">.</span><span class="token function">MakeThumbnail</span><span class="token punctuation">(</span><span class="token string">@&quot;D:\2.jpg&quot;</span><span class="token punctuation">,</span> <span class="token number">120</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> ThumbnailCutMode<span class="token punctuation">.</span>LockWidth<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//生成缩略图</span>

<span class="token class-name">Bitmap</span> bmp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Bitmap</span><span class="token punctuation">(</span><span class="token string">@&quot;D:\1.jpg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Bitmap</span> newBmp <span class="token operator">=</span> bmp<span class="token punctuation">.</span><span class="token function">BWPic</span><span class="token punctuation">(</span>bmp<span class="token punctuation">.</span>Width<span class="token punctuation">,</span> bmp<span class="token punctuation">.</span>Height<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//转换成黑白</span>
<span class="token class-name">Bitmap</span> newBmp <span class="token operator">=</span> bmp<span class="token punctuation">.</span><span class="token function">CutAndResize</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Rectangle</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1600</span><span class="token punctuation">,</span> <span class="token number">900</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">160</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//裁剪并缩放</span>
bmp<span class="token punctuation">.</span><span class="token function">RevPicLR</span><span class="token punctuation">(</span>bmp<span class="token punctuation">.</span>Width<span class="token punctuation">,</span> bmp<span class="token punctuation">.</span>Height<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//左右镜像</span>
bmp<span class="token punctuation">.</span><span class="token function">RevPicUD</span><span class="token punctuation">(</span>bmp<span class="token punctuation">.</span>Width<span class="token punctuation">,</span> bmp<span class="token punctuation">.</span>Height<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//上下镜像</span>

<span class="token class-name"><span class="token keyword">var</span></span> marker<span class="token operator">=</span><span class="token function">ImageWatermarker</span><span class="token punctuation">(</span>stream<span class="token punctuation">)</span><span class="token punctuation">;</span>
stream<span class="token operator">=</span>maker<span class="token punctuation">.</span><span class="token function">AddWatermark</span><span class="token punctuation">(</span><span class="token string">&quot;水印文字&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;字体文件&quot;</span><span class="token punctuation">,</span>字体大小<span class="token punctuation">,</span>color<span class="token punctuation">,</span>水印位置<span class="token punctuation">,</span>边距<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 给图片添加水印</span>
stream<span class="token operator">=</span>maker<span class="token punctuation">.</span><span class="token function">AddWatermark</span><span class="token punctuation">(</span>水印图片<span class="token punctuation">,</span>水印位置<span class="token punctuation">,</span>边距<span class="token punctuation">,</span>字体大小<span class="token punctuation">,</span>字体<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 给图片添加水印</span>

<span class="token comment">// 图像相似度对比</span>
<span class="token class-name"><span class="token keyword">var</span></span> hasher <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ImageHasher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> hash1 <span class="token operator">=</span> hasher<span class="token punctuation">.</span><span class="token function">DifferenceHash256</span><span class="token punctuation">(</span><span class="token string">&quot;图片1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 使用差分哈希算法计算图像的256位哈希</span>
<span class="token class-name"><span class="token keyword">var</span></span> hash2 <span class="token operator">=</span> hasher<span class="token punctuation">.</span><span class="token function">DifferenceHash256</span><span class="token punctuation">(</span><span class="token string">&quot;图片2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 使用差分哈希算法计算图像的256位哈希</span>
<span class="token comment">//var hash1 = hasher.AverageHash64(&quot;图片1&quot;); // 使用平均值算法计算图像的64位哈希</span>
<span class="token comment">//var hash2 = hasher.AverageHash64(&quot;图片2&quot;); // 使用平均值算法计算图像的64位哈希</span>
<span class="token comment">//var hash1 = hasher.DctHash(&quot;图片1&quot;); // 使用DCT算法计算图像的64位哈希</span>
<span class="token comment">//var hash2 = hasher.DctHash(&quot;图片2&quot;); // 使用DCT算法计算图像的64位哈希</span>
<span class="token comment">//var hash1 = hasher.MedianHash64(&quot;图片1&quot;); // 使用中值算法计算给定图像的64位哈希</span>
<span class="token comment">//var hash2 = hasher.MedianHash64(&quot;图片2&quot;); // 使用中值算法计算给定图像的64位哈希</span>
<span class="token class-name"><span class="token keyword">var</span></span> sim<span class="token operator">=</span>ImageHasher<span class="token punctuation">.</span><span class="token function">Compare</span><span class="token punctuation">(</span>hash1<span class="token punctuation">,</span>hash2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 图片的相似度，范围：[0,1]</span>

<span class="token class-name"><span class="token keyword">var</span></span> imageFormat<span class="token operator">=</span>stream<span class="token punctuation">.</span><span class="token function">GetImageType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获取图片的真实格式</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_26-随机数" tabindex="-1"><a class="header-anchor" href="#_26-随机数" aria-hidden="true">#</a> 26.随机数</h3><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token class-name">Random</span> rnd <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">int</span></span> num <span class="token operator">=</span> rnd<span class="token punctuation">.</span><span class="token function">StrictNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//产生真随机数</span>
<span class="token class-name"><span class="token keyword">double</span></span> gauss <span class="token operator">=</span> rnd<span class="token punctuation">.</span><span class="token function">NextGauss</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//产生正态高斯分布的随机数</span>
<span class="token class-name"><span class="token keyword">var</span></span> s <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">NumberFormater</span><span class="token punctuation">(</span><span class="token number">62</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Next</span><span class="token punctuation">(</span><span class="token number">100000</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">.</span>MaxValue<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//生成随机字符串</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_27-权重随机筛选功能" tabindex="-1"><a class="header-anchor" href="#_27-权重随机筛选功能" aria-hidden="true">#</a> 27.权重随机筛选功能</h3><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token class-name"><span class="token keyword">var</span></span> data<span class="token operator">=</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">List<span class="token punctuation">&lt;</span>WeightedItem<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
     <span class="token keyword">new</span> <span class="token constructor-invocation class-name">WeightedItem<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token string">&quot;A&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
     <span class="token keyword">new</span> <span class="token constructor-invocation class-name">WeightedItem<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token string">&quot;B&quot;</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
     <span class="token keyword">new</span> <span class="token constructor-invocation class-name">WeightedItem<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token string">&quot;C&quot;</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
     <span class="token keyword">new</span> <span class="token constructor-invocation class-name">WeightedItem<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token string">&quot;D&quot;</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> item<span class="token operator">=</span>data<span class="token punctuation">.</span><span class="token function">WeightedItem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//按权重选出1个元素</span>
<span class="token class-name"><span class="token keyword">var</span></span> list<span class="token operator">=</span>data<span class="token punctuation">.</span><span class="token function">WeightedItems</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//按权重选出2个元素</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token class-name"><span class="token keyword">var</span></span> selector <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">WeightedSelector<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">List<span class="token punctuation">&lt;</span>WeightedItem<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">new</span> <span class="token constructor-invocation class-name">WeightedItem<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token string">&quot;A&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token constructor-invocation class-name">WeightedItem<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token string">&quot;B&quot;</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token constructor-invocation class-name">WeightedItem<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token string">&quot;C&quot;</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token constructor-invocation class-name">WeightedItem<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token string">&quot;D&quot;</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> item <span class="token operator">=</span> selector<span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//按权重选出1个元素</span>
<span class="token class-name"><span class="token keyword">var</span></span> list <span class="token operator">=</span> selector<span class="token punctuation">.</span><span class="token function">SelectMultiple</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//按权重选出3个元素</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code>list<span class="token punctuation">.</span><span class="token function">WeightedItems</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span>e<span class="token operator">=&gt;</span>e<span class="token punctuation">.</span>Price<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 按价格权重选出3个元素</span>
list<span class="token punctuation">.</span><span class="token function">WeightedBy</span><span class="token punctuation">(</span>e<span class="token operator">=&gt;</span>e<span class="token punctuation">.</span>Price<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 按价格权重选出1个元素</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_28-ef-core支持addorupdate方法" tabindex="-1"><a class="header-anchor" href="#_28-ef-core支持addorupdate方法" aria-hidden="true">#</a> 28.EF Core支持AddOrUpdate方法</h3><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token doc-comment comment">/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span></span>
<span class="token doc-comment comment">/// 按Id添加或更新文章实体</span>
<span class="token doc-comment comment">/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span></span>
<span class="token keyword">public</span> <span class="token keyword">override</span> <span class="token return-type class-name">Post</span> <span class="token function">SavePost</span><span class="token punctuation">(</span><span class="token class-name">Post</span> t<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    DataContext<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Set</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Post<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">AddOrUpdate</span><span class="token punctuation">(</span>t <span class="token operator">=&gt;</span> t<span class="token punctuation">.</span>Id<span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> t<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_29-敏感信息掩码" tabindex="-1"><a class="header-anchor" href="#_29-敏感信息掩码" aria-hidden="true">#</a> 29.敏感信息掩码</h3><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token string">&quot;13123456789&quot;</span><span class="token punctuation">.</span><span class="token function">Mask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 131****5678</span>
<span class="token string">&quot;admin@masuit.com&quot;</span><span class="token punctuation">.</span><span class="token function">MaskEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// a****n@masuit.com</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_30-集合扩展" tabindex="-1"><a class="header-anchor" href="#_30-集合扩展" aria-hidden="true">#</a> 30.集合扩展</h3><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token class-name"><span class="token keyword">var</span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">List<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;3&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;3&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;3&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
list<span class="token punctuation">.</span><span class="token function">AddRangeIf</span><span class="token punctuation">(</span>s <span class="token operator">=&gt;</span> s<span class="token punctuation">.</span>Length <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;11&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 将被添加元素中的长度大于1的元素添加到list</span>
list<span class="token punctuation">.</span><span class="token function">AddRangeIfNotContains</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;11&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 将被添加元素中不包含的元素添加到list</span>
list<span class="token punctuation">.</span><span class="token function">RemoveWhere</span><span class="token punctuation">(</span>s <span class="token operator">=&gt;</span> s<span class="token punctuation">.</span>Length<span class="token operator">&lt;</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 将集合中长度小于1的元素移除</span>
list<span class="token punctuation">.</span><span class="token function">InsertAfter</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&quot;2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 在第一个元素之后插入</span>
list<span class="token punctuation">.</span><span class="token function">InsertAfter</span><span class="token punctuation">(</span>s <span class="token operator">=&gt;</span> s <span class="token operator">==</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 在元素&quot;1&quot;后插入</span>
<span class="token class-name"><span class="token keyword">var</span></span> dic <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">ToDictionarySafety</span><span class="token punctuation">(</span>s <span class="token operator">=&gt;</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 安全的转换成字典类型，当键重复时只添加一个键</span>
<span class="token class-name"><span class="token keyword">var</span></span> dic <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">ToConcurrentDictionary</span><span class="token punctuation">(</span>s <span class="token operator">=&gt;</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 转换成并发字典类型，当键重复时只添加一个键</span>
<span class="token class-name"><span class="token keyword">var</span></span> dic <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">ToDictionarySafety</span><span class="token punctuation">(</span>s <span class="token operator">=&gt;</span> s<span class="token punctuation">,</span> s <span class="token operator">=&gt;</span> s<span class="token punctuation">.</span><span class="token function">GetHashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 安全的转换成字典类型，当键重复时只添加一个键</span>
dic<span class="token punctuation">.</span><span class="token function">AddOrUpdate</span><span class="token punctuation">(</span><span class="token string">&quot;4&quot;</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 添加或更新键值对</span>
dic<span class="token punctuation">.</span><span class="token function">AddOrUpdate</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Dictionary<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token string">&quot;5&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">&quot;55&quot;</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">555</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 批量添加或更新键值对</span>
dic<span class="token punctuation">.</span><span class="token function">AddOrUpdate</span><span class="token punctuation">(</span><span class="token string">&quot;5&quot;</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>s<span class="token punctuation">,</span> i<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token number">66</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 如果是添加，则值为6，若更新则值为66</span>
dic<span class="token punctuation">.</span><span class="token function">AddOrUpdate</span><span class="token punctuation">(</span><span class="token string">&quot;5&quot;</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">666</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 如果是添加，则值为6，若更新则值为666</span>
dic<span class="token punctuation">.</span><span class="token function">GetOrAdd</span><span class="token punctuation">(</span><span class="token string">&quot;7&quot;</span><span class="token punctuation">,</span><span class="token number">77</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 字典获取或添加元素</span>
dic<span class="token punctuation">.</span><span class="token function">GetOrAdd</span><span class="token punctuation">(</span><span class="token string">&quot;7&quot;</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token number">77</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 字典获取或添加元素</span>
dic<span class="token punctuation">.</span><span class="token function">AsConcurrentDictionary</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 普通字典转换成并发字典集合</span>
<span class="token class-name"><span class="token keyword">var</span></span> table<span class="token operator">=</span>list<span class="token punctuation">.</span><span class="token function">ToDataTable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 转换成DataTable类型</span>
table<span class="token punctuation">.</span><span class="token function">AddIdentityColumn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//给DataTable增加一个自增列</span>
table<span class="token punctuation">.</span><span class="token function">HasRows</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 检查DataTable 是否有数据行</span>
table<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">ToList</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// datatable转List</span>
<span class="token class-name"><span class="token keyword">var</span></span> <span class="token keyword">set</span> <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">ToHashSet</span><span class="token punctuation">(</span>s<span class="token operator">=&gt;</span>s<span class="token punctuation">.</span>Name<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 转HashSet</span>
<span class="token class-name"><span class="token keyword">var</span></span> cts <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">CancellationTokenSource</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//取消口令</span>
<span class="token keyword">await</span> list<span class="token punctuation">.</span><span class="token function">ForeachAsync</span><span class="token punctuation">(</span><span class="token keyword">async</span> i<span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">await</span> Task<span class="token punctuation">.</span><span class="token function">Delay</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>cts<span class="token punctuation">.</span>Token<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 异步foreach</span>

<span class="token keyword">await</span> list<span class="token punctuation">.</span><span class="token function">ForAsync</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span>item<span class="token punctuation">,</span>index<span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">await</span> Task<span class="token punctuation">.</span><span class="token function">Delay</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>item<span class="token operator">+</span><span class="token string">&quot;_&quot;</span><span class="token operator">+</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>cts<span class="token punctuation">.</span>Token<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 异步for，带索引编号</span>
<span class="token keyword">await</span> list<span class="token punctuation">.</span><span class="token function">SelectAsync</span><span class="token punctuation">(</span><span class="token keyword">async</span> i<span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">await</span> Task<span class="token punctuation">.</span><span class="token function">Delay</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> i<span class="token operator">*</span><span class="token number">10</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 异步Select</span>
<span class="token keyword">await</span> list<span class="token punctuation">.</span><span class="token function">SelectAsync</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span>item<span class="token punctuation">,</span>index<span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">await</span> Task<span class="token punctuation">.</span><span class="token function">Delay</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> item<span class="token operator">*</span><span class="token number">10</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 异步Select，带索引编号</span>
<span class="token class-name"><span class="token keyword">string</span></span> s<span class="token operator">=</span>list<span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span><span class="token string">&quot;,&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//将字符串集合连接成逗号分隔的单字符串</span>
<span class="token class-name"><span class="token keyword">var</span></span> max<span class="token operator">=</span>list<span class="token punctuation">.</span><span class="token function">MaxOrDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 取最大值，当集合为空的时候不会报错</span>
<span class="token class-name"><span class="token keyword">var</span></span> max<span class="token operator">=</span>list<span class="token punctuation">.</span><span class="token function">MaxOrDefault</span><span class="token punctuation">(</span>selector<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 取最大值，当集合为空的时候不会报错</span>
<span class="token class-name"><span class="token keyword">var</span></span> max<span class="token operator">=</span>list<span class="token punctuation">.</span><span class="token function">MaxOrDefault</span><span class="token punctuation">(</span>selector<span class="token punctuation">,</span><span class="token keyword">default</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 取最大值，当集合为空的时候不会报错</span>
<span class="token class-name"><span class="token keyword">var</span></span> max<span class="token operator">=</span>list<span class="token punctuation">.</span><span class="token function">MinOrDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 取最小值，当集合为空的时候不会报错</span>
<span class="token class-name"><span class="token keyword">var</span></span> max<span class="token operator">=</span>list<span class="token punctuation">.</span><span class="token function">MinOrDefault</span><span class="token punctuation">(</span>selector<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 取最小值，当集合为空的时候不会报错</span>
<span class="token class-name"><span class="token keyword">var</span></span> max<span class="token operator">=</span>list<span class="token punctuation">.</span><span class="token function">MinOrDefault</span><span class="token punctuation">(</span>selector<span class="token punctuation">,</span><span class="token keyword">default</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 取最小值，当集合为空的时候不会报错</span>
<span class="token class-name"><span class="token keyword">var</span></span> stdDev<span class="token operator">=</span>list<span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span>s<span class="token operator">=&gt;</span>s<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">ConvertTo</span><span class="token generic class-name"><span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">StandardDeviation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 求标准差</span>

<span class="token class-name"><span class="token keyword">var</span></span> pages<span class="token operator">=</span>queryable<span class="token punctuation">.</span><span class="token function">ToPagedList</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 分页查询</span>
<span class="token class-name"><span class="token keyword">var</span></span> pages<span class="token operator">=</span><span class="token keyword">await</span> queryable<span class="token punctuation">.</span><span class="token function">ToPagedListAsync</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 分页查询</span>

<span class="token class-name"><span class="token keyword">var</span></span> nums<span class="token operator">=</span>Enumerable<span class="token punctuation">.</span><span class="token function">Range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ExceptBy</span><span class="token punctuation">(</span>Enumerable<span class="token punctuation">.</span><span class="token function">Range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> i <span class="token operator">=&gt;</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 按字段取差集</span>
<span class="token class-name"><span class="token keyword">var</span></span> nums<span class="token operator">=</span>Enumerable<span class="token punctuation">.</span><span class="token function">Range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">IntersectBy</span><span class="token punctuation">(</span>Enumerable<span class="token punctuation">.</span><span class="token function">Range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> i <span class="token operator">=&gt;</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 按字段取交集</span>
<span class="token class-name"><span class="token keyword">var</span></span> nums<span class="token operator">=</span>Enumerable<span class="token punctuation">.</span><span class="token function">Range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">SequenceEqual</span><span class="token punctuation">(</span>Enumerable<span class="token punctuation">.</span><span class="token function">Range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> i <span class="token operator">=&gt;</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 判断序列相等</span>
<span class="token class-name"><span class="token keyword">var</span></span> nums<span class="token operator">=</span>Enumerable<span class="token punctuation">.</span><span class="token function">Range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">OrderByRandom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 随机排序</span>

<span class="token comment">// 多个集合取交集</span>
<span class="token class-name"><span class="token keyword">var</span></span> list<span class="token operator">=</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">List<span class="token punctuation">&lt;</span>List<span class="token punctuation">&lt;</span>MyClass<span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">new</span> <span class="token constructor-invocation class-name">List<span class="token punctuation">&lt;</span>MyClass<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MyClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>Name<span class="token operator">=</span><span class="token string">&quot;aa&quot;</span><span class="token punctuation">,</span>Age<span class="token operator">=</span><span class="token number">11</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MyClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>Name<span class="token operator">=</span><span class="token string">&quot;bb&quot;</span><span class="token punctuation">,</span>Age<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MyClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>Name<span class="token operator">=</span><span class="token string">&quot;cc&quot;</span><span class="token punctuation">,</span>Age<span class="token operator">=</span><span class="token number">13</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token constructor-invocation class-name">List<span class="token punctuation">&lt;</span>MyClass<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MyClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>Name<span class="token operator">=</span><span class="token string">&quot;bb&quot;</span><span class="token punctuation">,</span>Age<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MyClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>Name<span class="token operator">=</span><span class="token string">&quot;cc&quot;</span><span class="token punctuation">,</span>Age<span class="token operator">=</span><span class="token number">13</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MyClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>Name<span class="token operator">=</span><span class="token string">&quot;dd&quot;</span><span class="token punctuation">,</span>Age<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token constructor-invocation class-name">List<span class="token punctuation">&lt;</span>MyClass<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MyClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>Name<span class="token operator">=</span><span class="token string">&quot;cc&quot;</span><span class="token punctuation">,</span>Age<span class="token operator">=</span><span class="token number">13</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MyClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>Name<span class="token operator">=</span><span class="token string">&quot;dd&quot;</span><span class="token punctuation">,</span>Age<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MyClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>Name<span class="token operator">=</span><span class="token string">&quot;ee&quot;</span><span class="token punctuation">,</span>Age<span class="token operator">=</span><span class="token number">15</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> sect<span class="token operator">=</span>list<span class="token punctuation">.</span><span class="token function">IntersectAll</span><span class="token punctuation">(</span>m<span class="token operator">=&gt;</span>m<span class="token punctuation">.</span>Name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// new MyClass(){Name=&quot;cc&quot;,Age=13}</span>

<span class="token class-name"><span class="token keyword">var</span></span> list<span class="token operator">=</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">List<span class="token punctuation">&lt;</span>List<span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> sect<span class="token operator">=</span>list<span class="token punctuation">.</span><span class="token function">IntersectAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// [3]</span>

<span class="token comment">// 集合元素改变其索引位置</span>
list<span class="token punctuation">.</span><span class="token function">ChangeIndex</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 将元素item的索引位置变为第3个</span>
list<span class="token punctuation">.</span><span class="token function">ChangeIndex</span><span class="token punctuation">(</span>t<span class="token operator">=&gt;</span>t<span class="token punctuation">.</span>Id<span class="token operator">==</span><span class="token string">&quot;123&quot;</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 将id为123的元素的索引位置变为第2个</span>

<span class="token class-name"><span class="token keyword">var</span></span> item<span class="token operator">=</span>list<span class="token punctuation">.</span><span class="token function">Percentile</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 取第50%分位数的元素</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_31-mime类型" tabindex="-1"><a class="header-anchor" href="#_31-mime类型" aria-hidden="true">#</a> 31.Mime类型</h3><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token class-name"><span class="token keyword">var</span></span> mimeMapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MimeMapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> ext <span class="token operator">=</span> mimeMapper<span class="token punctuation">.</span><span class="token function">GetExtensionFromMime</span><span class="token punctuation">(</span><span class="token string">&quot;image/jpeg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// .jpg</span>
<span class="token class-name"><span class="token keyword">var</span></span> mime <span class="token operator">=</span> mimeMapper<span class="token punctuation">.</span><span class="token function">GetMimeFromExtension</span><span class="token punctuation">(</span><span class="token string">&quot;.jpg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// image/jpeg</span>

ContentType常量库：
<span class="token class-name"><span class="token keyword">var</span></span> type<span class="token operator">=</span>ContentType<span class="token punctuation">.</span>Exe<span class="token punctuation">;</span> <span class="token comment">// application/octet-stream</span>
<span class="token class-name"><span class="token keyword">var</span></span> type<span class="token operator">=</span>ContentType<span class="token punctuation">.</span>Jpeg<span class="token punctuation">;</span> <span class="token comment">// image/jpeg</span>
<span class="token class-name"><span class="token keyword">var</span></span> type<span class="token operator">=</span>DefaultMimeItems<span class="token punctuation">.</span>Items<span class="token punctuation">.</span><span class="token function">FirstOrDefault</span><span class="token punctuation">(</span>t<span class="token operator">=&gt;</span>t<span class="token punctuation">.</span>Extension<span class="token operator">==</span><span class="token string">&quot;jpg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// image/jpeg</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_32-日期时间扩展" tabindex="-1"><a class="header-anchor" href="#_32-日期时间扩展" aria-hidden="true">#</a> 32.日期时间扩展</h3><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code>
<span class="token class-name"><span class="token keyword">double</span></span> milliseconds <span class="token operator">=</span> DateTime<span class="token punctuation">.</span>Now<span class="token punctuation">.</span><span class="token function">GetTotalMilliseconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 获取毫秒级时间戳</span>
<span class="token class-name"><span class="token keyword">double</span></span> microseconds <span class="token operator">=</span> DateTime<span class="token punctuation">.</span>Now<span class="token punctuation">.</span><span class="token function">GetTotalMicroseconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 获取微秒级时间戳</span>
<span class="token class-name"><span class="token keyword">double</span></span> nanoseconds <span class="token operator">=</span> DateTime<span class="token punctuation">.</span>Now<span class="token punctuation">.</span><span class="token function">GetTotalNanoseconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 获取纳秒级时间戳</span>
<span class="token class-name"><span class="token keyword">double</span></span> seconds <span class="token operator">=</span> DateTime<span class="token punctuation">.</span>Now<span class="token punctuation">.</span><span class="token function">GetTotalSeconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 获取秒级时间戳</span>
<span class="token class-name"><span class="token keyword">double</span></span> minutes <span class="token operator">=</span> DateTime<span class="token punctuation">.</span>Now<span class="token punctuation">.</span><span class="token function">GetTotalMinutes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 获取分钟级时间戳</span>

<span class="token class-name"><span class="token keyword">var</span></span> indate<span class="token operator">=</span>DateTime<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span><span class="token string">&quot;2020-8-3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">In</span><span class="token punctuation">(</span>DateTime<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span><span class="token string">&quot;2020-8-2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>DateTime<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span><span class="token string">&quot;2020-8-4&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//true</span>
<span class="token class-name">DateTime</span> time<span class="token operator">=</span><span class="token string">&quot;2021-1-1 8:00:00&quot;</span><span class="token punctuation">.</span><span class="token function">ToDateTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//字符串转DateTime</span>

<span class="token comment">//时间段计算工具</span>
<span class="token class-name"><span class="token keyword">var</span></span> range <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">DateTimeRange</span><span class="token punctuation">(</span>DateTime<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span><span class="token string">&quot;2020-8-3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> DateTime<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span><span class="token string">&quot;2020-8-5&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
range<span class="token punctuation">.</span><span class="token function">Union</span><span class="token punctuation">(</span>DateTime<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span><span class="token string">&quot;2020-8-4&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> DateTime<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span><span class="token string">&quot;2020-8-6&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//连接两个时间段，结果：2020-8-3~2020-8-6</span>
range<span class="token punctuation">.</span><span class="token function">In</span><span class="token punctuation">(</span>DateTime<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span><span class="token string">&quot;2020-8-3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> DateTime<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span><span class="token string">&quot;2020-8-6&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//判断是否在某个时间段内，true</span>
<span class="token keyword">var</span> <span class="token punctuation">(</span>intersected<span class="token punctuation">,</span>range2<span class="token punctuation">)</span> <span class="token operator">=</span> range<span class="token punctuation">.</span><span class="token function">Intersect</span><span class="token punctuation">(</span>DateTime<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span><span class="token string">&quot;2020-8-4&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> DateTime<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span><span class="token string">&quot;2020-8-6&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//两个时间段是否相交，(true,2020-8-3~2020-8-4)</span>
range<span class="token punctuation">.</span><span class="token function">Contains</span><span class="token punctuation">(</span>DateTime<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span><span class="token string">&quot;2020-8-3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> DateTime<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span><span class="token string">&quot;2020-8-4&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//判断是否包含某个时间段，true</span>

range<span class="token punctuation">.</span><span class="token function">GetUnionSet</span><span class="token punctuation">(</span>List<span class="token operator">&lt;</span>DateTimeRange<span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 根据某个时间段查找在某批时间段中的最大并集</span>
range<span class="token punctuation">.</span><span class="token function">GetMaxTimePeriod</span><span class="token punctuation">(</span>List<span class="token operator">&lt;</span>DateTimeRange<span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获取一批时间段内存在相互重叠的最大时间段</span>
<span class="token range operator">..</span><span class="token punctuation">.</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_33-流相关" tabindex="-1"><a class="header-anchor" href="#_33-流相关" aria-hidden="true">#</a> 33.流相关</h3><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code>stream<span class="token punctuation">.</span><span class="token function">SaveAsMemoryStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 任意流转换成内存流</span>
stream<span class="token punctuation">.</span><span class="token function">ToArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 任意流转换成二进制数组</span>
stream<span class="token punctuation">.</span><span class="token function">ToArrayAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 任意流转换成二进制数组</span>
stream<span class="token punctuation">.</span><span class="token function">ShuffleCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 流洗码，在流的末端随即增加几个空字节，重要数据请谨慎使用，可能造成流损坏</span>

<span class="token comment">// 池化内存流，用法与MemorySteam保持一致</span>
<span class="token keyword">using</span> <span class="token class-name"><span class="token keyword">var</span></span> ms<span class="token operator">=</span><span class="token function">PooledMemoryStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 大型内存流,最大可支持1TB内存数据，推荐当数据流大于2GB时使用，用法与MemorySteam保持一致</span>
<span class="token keyword">using</span> <span class="token class-name"><span class="token keyword">var</span></span> ms<span class="token operator">=</span><span class="token function">LargeMemoryStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//文件流快速复制</span>
<span class="token class-name">FileStream</span> fs <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">FileStream</span><span class="token punctuation">(</span><span class="token string">@&quot;D:\boot.vmdk&quot;</span><span class="token punctuation">,</span> FileMode<span class="token punctuation">.</span>OpenOrCreate<span class="token punctuation">,</span> FileAccess<span class="token punctuation">.</span>ReadWrite<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">{</span>
        <span class="token comment">//fs.CopyToFile(@&quot;D:\1.bak&quot;);//同步复制大文件</span>
        fs<span class="token punctuation">.</span><span class="token function">CopyToFileAsync</span><span class="token punctuation">(</span><span class="token string">@&quot;D:\1.bak&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//异步复制大文件</span>
        <span class="token class-name"><span class="token keyword">string</span></span> md5 <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">GetFileMD5Async</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Result<span class="token punctuation">;</span><span class="token comment">//异步获取文件的MD5</span>
        <span class="token class-name"><span class="token keyword">string</span></span> sha1 <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">GetFileSha1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//异步获取文件的SHA1</span>
<span class="token punctuation">}</span>
memoryStream<span class="token punctuation">.</span><span class="token function">SaveFile</span><span class="token punctuation">(</span><span class="token string">&quot;filename&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 将内存流转储成文件</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_34-类型操作" tabindex="-1"><a class="header-anchor" href="#_34-类型操作" aria-hidden="true">#</a> 34.类型操作</h3><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token number">1.2345678901</span><span class="token punctuation">.</span><span class="token function">Digits8</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 将小数截断为8位</span>
<span class="token number">1.23</span><span class="token punctuation">.</span><span class="token generic-method"><span class="token function">ConvertTo</span><span class="token generic class-name"><span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 小数转int</span>
<span class="token number">1.23</span><span class="token punctuation">.</span><span class="token generic-method"><span class="token function">ConvertTo</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 小数转T基本类型</span>
<span class="token class-name"><span class="token keyword">bool</span></span> b<span class="token operator">=</span><span class="token number">1.23</span><span class="token punctuation">.</span><span class="token generic-method"><span class="token function">TryConvertTo</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token keyword">out</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 小数转T基本类型</span>
<span class="token class-name"><span class="token keyword">var</span></span> num<span class="token operator">=</span><span class="token number">1.2345</span><span class="token punctuation">.</span><span class="token function">ToDecimal</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//转decimal并保留两位小数</span>

<span class="token number">1.23</span><span class="token punctuation">.</span><span class="token generic-method"><span class="token function">ChangeTypeTo</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//小数转T基本类型,ConvertTo和ChangeTypeTo的区别在于：ConvertTo只适用于基元类型的互转，ChangeTypeTo不仅适用于基元类型的互转还支持数组、字符串的转换(Parse)，ConvertTo的性能更高</span>

type<span class="token punctuation">.</span><span class="token function">IsPrimitive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 判断类型是否是值类型</span>
type<span class="token punctuation">.</span><span class="token function">IsSimpleType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 判断类型是否是常见的简单类型，基元类型为 Boolean、 Byte、 SByte、 Int16、 UInt16、 Int32、 UInt32、 Int64、 UInt64、 IntPtr、 UIntPtr、 Char、 Double 、 Single、枚举、Nullable&lt;T&gt;。</span>
type<span class="token punctuation">.</span><span class="token function">IsSimpleArrayType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 判断类型是否是常见类型的 数组形式 类型</span>
type<span class="token punctuation">.</span><span class="token function">IsSimpleListType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 判断类型是否是常见类型的 泛型形式 类型</span>

myClass<span class="token punctuation">.</span><span class="token function">ToJsonString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//序列化成json字符串</span>

<span class="token class-name"><span class="token keyword">string</span></span> s<span class="token operator">=</span><span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">bool</span></span> b<span class="token operator">=</span>s<span class="token punctuation">.</span><span class="token function">IsNullOrEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//判断字符串是否为空</span>
<span class="token class-name"><span class="token keyword">bool</span></span> b<span class="token operator">=</span>s<span class="token punctuation">.</span><span class="token function">NotNullOrEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//判断字符串不为空</span>
<span class="token class-name"><span class="token keyword">string</span></span> str<span class="token operator">=</span>s<span class="token punctuation">.</span><span class="token function">IfNullOrEmpty</span><span class="token punctuation">(</span><span class="token string">&quot;aa&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//如果为空则返回aa</span>
<span class="token class-name"><span class="token keyword">string</span></span> str<span class="token operator">=</span>s<span class="token punctuation">.</span><span class="token function">IfNullOrEmpty</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token string">&quot;aa&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//如果为空则返回aa,延迟执行</span>

<span class="token class-name"><span class="token keyword">bool</span></span> contains<span class="token operator">=</span>s<span class="token punctuation">.</span><span class="token function">Contains</span><span class="token punctuation">(</span><span class="token keyword">new</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token string">&quot;aa&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;bb&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 检测字符串中是否包含列表中的关键词(快速匹配)</span>
<span class="token class-name"><span class="token keyword">bool</span></span> contains<span class="token operator">=</span>s<span class="token punctuation">.</span><span class="token function">ContainsSafety</span><span class="token punctuation">(</span><span class="token keyword">new</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token string">&quot;aa&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;bb&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 检测字符串中是否包含列表中的关键词(安全匹配)，没有计时攻击风险</span>
<span class="token class-name"><span class="token keyword">bool</span></span> contains<span class="token operator">=</span>s<span class="token punctuation">.</span><span class="token function">EndsWith</span><span class="token punctuation">(</span><span class="token keyword">new</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token string">&quot;aa&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;bb&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 检测字符串中是否以列表中的任意关键词结尾</span>
<span class="token class-name"><span class="token keyword">bool</span></span> contains<span class="token operator">=</span>s<span class="token punctuation">.</span><span class="token function">StartsWith</span><span class="token punctuation">(</span><span class="token keyword">new</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token string">&quot;aa&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;bb&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 检测字符串中是否以列表中的任意关键词开头</span>

<span class="token class-name"><span class="token keyword">string</span></span> str<span class="token operator">=</span>s<span class="token punctuation">.</span><span class="token function">Take</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 取字符串前10个字符</span>

<span class="token class-name"><span class="token keyword">bool</span></span> emoji<span class="token operator">=</span>s<span class="token punctuation">.</span><span class="token function">MatchEmoji</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 匹配字符串是否包含emoji</span>

<span class="token class-name"><span class="token keyword">var</span></span> width<span class="token operator">=</span>str<span class="token punctuation">.</span><span class="token function">StringWidth</span><span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 计算字符串以14号字体大小的渲染宽度像素</span>
<span class="token class-name"><span class="token keyword">var</span></span> width<span class="token operator">=</span>str<span class="token punctuation">.</span><span class="token function">StringWidth</span><span class="token punctuation">(</span><span class="token string">&quot;微软雅黑&quot;</span><span class="token punctuation">,</span><span class="token number">14</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 计算字符串以14号字体大小的微软雅黑字体的渲染宽度像素</span>
<span class="token class-name"><span class="token keyword">var</span></span> width<span class="token operator">=</span>str<span class="token punctuation">.</span><span class="token function">CharacterCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获取字符串的字符数</span>
<span class="token class-name"><span class="token keyword">var</span></span> width<span class="token operator">=</span>str<span class="token punctuation">.</span><span class="token function">BytesCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获取字符串的字节数</span>


<span class="token class-name"><span class="token keyword">var</span></span> s <span class="token operator">=</span> <span class="token string">&quot;🤔1🥳a👨‍👩‍👧‍👦啊&quot;</span><span class="token punctuation">;</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;长度：&quot;</span> <span class="token operator">+</span> s<span class="token punctuation">.</span>Length<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 18</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;宽度：&quot;</span> <span class="token operator">+</span> s<span class="token punctuation">.</span><span class="token function">StringWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 7</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;字节数：&quot;</span> <span class="token operator">+</span> s<span class="token punctuation">.</span><span class="token function">BytesCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 38</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;字符数：&quot;</span> <span class="token operator">+</span> s<span class="token punctuation">.</span><span class="token function">CharacterCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 6</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_35-ini配置文件操作-仅支持windows" tabindex="-1"><a class="header-anchor" href="#_35-ini配置文件操作-仅支持windows" aria-hidden="true">#</a> 35.INI配置文件操作(仅支持Windows)</h3><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token class-name">INIFile</span> ini<span class="token operator">=</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">INIFile</span><span class="token punctuation">(</span><span class="token string">&quot;filename.ini&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ini<span class="token punctuation">.</span><span class="token function">IniWriteValue</span><span class="token punctuation">(</span>section<span class="token punctuation">,</span>key<span class="token punctuation">,</span><span class="token keyword">value</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 写值</span>
ini<span class="token punctuation">.</span><span class="token function">IniReadValue</span><span class="token punctuation">(</span>section<span class="token punctuation">,</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 读值</span>
ini<span class="token punctuation">.</span><span class="token function">ClearAllSection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 清空所有配置节</span>
ini<span class="token punctuation">.</span><span class="token function">ClearSection</span><span class="token punctuation">(</span>section<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 清空配置节</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_36-雷达图计算引擎" tabindex="-1"><a class="header-anchor" href="#_36-雷达图计算引擎" aria-hidden="true">#</a> 36.雷达图计算引擎</h3><p>应用场景：计算两个多边形的相似度，用户画像之类的</p><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token class-name"><span class="token keyword">var</span></span> points<span class="token operator">=</span>RadarChartEngine<span class="token punctuation">.</span><span class="token function">ComputeIntersection</span><span class="token punctuation">(</span>chart1<span class="token punctuation">,</span>chart2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//获取两个多边形的相交区域</span>
points<span class="token punctuation">.</span><span class="token function">ComputeArea</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//计算多边形面积</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_37-树形结构实现" tabindex="-1"><a class="header-anchor" href="#_37-树形结构实现" aria-hidden="true">#</a> 37.树形结构实现</h3><p>基本接口类： ITreeChildren：带Children属性的接口 ITreeParent：带Parent属性的接口 ITree：继承ITreeParent和ITreeChildren，同时多了Name属性</p><p>相关扩展方法：</p><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code>trees<span class="token punctuation">.</span><span class="token function">Filter</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 从树形集合中过滤</span>
trees<span class="token punctuation">.</span><span class="token function">Flatten</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 将数据平铺开</span>
tree<span class="token punctuation">.</span><span class="token function">AllChildren</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获取所有的子级</span>
tree<span class="token punctuation">.</span><span class="token function">AllParent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获取所有的父级</span>
tree<span class="token punctuation">.</span><span class="token function">IsRoot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 是否是根节点</span>
tree<span class="token punctuation">.</span><span class="token function">IsLeaf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 是否是叶子节点</span>
tree<span class="token punctuation">.</span><span class="token function">Level</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 所处深度/层级</span>
tree<span class="token punctuation">.</span><span class="token function">Path</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 全路径</span>

<span class="token class-name"><span class="token keyword">var</span></span> tree<span class="token operator">=</span>list<span class="token punctuation">.</span><span class="token function">ToTree</span><span class="token punctuation">(</span>c <span class="token operator">=&gt;</span> c<span class="token punctuation">.</span>Id<span class="token punctuation">,</span> c <span class="token operator">=&gt;</span> c<span class="token punctuation">.</span>Pid<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//继承自ITreeParent&lt;T&gt;, ITreeChildren&lt;T&gt;的集合转换成树形结构</span>
<span class="token class-name"><span class="token keyword">var</span></span> tree<span class="token operator">=</span>list<span class="token punctuation">.</span><span class="token function">ToTreeGeneral</span><span class="token punctuation">(</span>c <span class="token operator">=&gt;</span> c<span class="token punctuation">.</span>Id<span class="token punctuation">,</span> c <span class="token operator">=&gt;</span> c<span class="token punctuation">.</span>Pid<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//一般的集合转换成树形结构</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_38-简单的excel导出" tabindex="-1"><a class="header-anchor" href="#_38-简单的excel导出" aria-hidden="true">#</a> 38.简单的Excel导出</h3><p>需要额外依赖包：<code>Masuit.Tools.Excel</code></p><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token class-name"><span class="token keyword">var</span></span> stream<span class="token operator">=</span>list<span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span>item<span class="token operator">=&gt;</span><span class="token keyword">new</span><span class="token punctuation">{</span>
    姓名<span class="token operator">=</span>item<span class="token punctuation">.</span>Name<span class="token punctuation">,</span>
    年龄<span class="token operator">=</span>item<span class="token punctuation">.</span>Age<span class="token punctuation">,</span>
    item<span class="token punctuation">.</span>Gender<span class="token punctuation">,</span>
    Avatar<span class="token operator">=</span>Image<span class="token punctuation">.</span><span class="token function">FromStream</span><span class="token punctuation">(</span>filestream<span class="token punctuation">)</span> <span class="token comment">//图片列</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToDataTable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToExcel</span><span class="token punctuation">(</span><span class="token string">&quot;Sheet1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//自定义列名导出</span>
<span class="token class-name"><span class="token keyword">var</span></span> stream<span class="token operator">=</span>list<span class="token punctuation">.</span><span class="token function">ToDataTable</span><span class="token punctuation">(</span><span class="token string">&quot;Sheet1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToExcel</span><span class="token punctuation">(</span><span class="token string">&quot;文件密码&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="一些约定规则" tabindex="-1"><a class="header-anchor" href="#一些约定规则" aria-hidden="true">#</a> 一些约定规则：</h4><ol><li>图片列支持Stream、Bitmap、IEnumerable <code>&lt;Stream&gt;</code>、IEnumerable <code>&lt;Bitmap&gt;</code>、IDictionary&lt;string,Stream&gt;、IDictionary&lt;string,MemoryStream&gt;、IDictionary&lt;string,Bitmap&gt;类型；</li><li>其中，如果是IDictionary类型的图片列，字典的键为图片超链接的完整url；</li><li>默认字段名作为列名导出；</li><li>若list是一个具体的强类型，默认会先查找每个字段的Description标记，若有Description标记，则取Description标记作为列名显示</li><li>ToExcel方法支持DataTable、List <code>&lt;DataTable&gt;</code>、Dictionary&lt;string, DataTable&gt;类型的直接调用</li></ol><h3 id="_39-efcore实用扩展" tabindex="-1"><a class="header-anchor" href="#_39-efcore实用扩展" aria-hidden="true">#</a> 39.EFCore实用扩展</h3><h4 id="跟踪实体变更对比" tabindex="-1"><a class="header-anchor" href="#跟踪实体变更对比" aria-hidden="true">#</a> 跟踪实体变更对比</h4><p>获取指定实体的变更</p><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token class-name"><span class="token keyword">var</span></span> changes<span class="token operator">=</span>dbContext<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetChanges</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>TEntity<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//获取变更字段信息</span>
<span class="token class-name"><span class="token keyword">var</span></span> added<span class="token operator">=</span>dbContext<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetAdded</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>TEntity<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//获取添加的实体字段信息</span>
<span class="token class-name"><span class="token keyword">var</span></span> removed<span class="token operator">=</span>dbContext<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetRemoved</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>TEntity<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//获取被移除的实体字段信息  </span>
<span class="token class-name"><span class="token keyword">var</span></span> allchanges<span class="token operator">=</span>dbContext<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetAllChanges</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>TEntity<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//获取增删改的实体字段信息  </span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>获取所有实体的变更</p><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token class-name"><span class="token keyword">var</span></span> changes<span class="token operator">=</span>dbContext<span class="token punctuation">.</span><span class="token function">GetChanges</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//获取变更字段信息</span>
<span class="token class-name"><span class="token keyword">var</span></span> added<span class="token operator">=</span>dbContext<span class="token punctuation">.</span><span class="token function">GetAdded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//获取添加的实体字段信息</span>
<span class="token class-name"><span class="token keyword">var</span></span> removed<span class="token operator">=</span>dbContext<span class="token punctuation">.</span><span class="token function">GetRemoved</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//获取被移除的实体字段信息  </span>
<span class="token class-name"><span class="token keyword">var</span></span> allchanges<span class="token operator">=</span>dbContext<span class="token punctuation">.</span><span class="token function">GetAllChanges</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//获取增删改的实体字段信息  </span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>对比信息包含属性信息、旧值、新值、实体信息、键信息、变更状态等</p><h4 id="nolock查询" tabindex="-1"><a class="header-anchor" href="#nolock查询" aria-hidden="true">#</a> nolock查询</h4><p>sqlserver：</p><p>上下文注入Interceptor即可在任何查询时使用nolock查询</p><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code>services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddDbContext</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>TContext<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>opt <span class="token operator">=&gt;</span> opt<span class="token punctuation">.</span><span class="token function">UseSqlserver</span><span class="token punctuation">(</span><span class="token string">&quot;ConnString&quot;</span><span class="token punctuation">,</span> builder <span class="token operator">=&gt;</span> builder<span class="token punctuation">.</span><span class="token function">AddInterceptors</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">QueryWithNoLockDbCommandInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>通用数据库：</p><p>nolock本质是开启一个 <code>读未提交</code>级别的事务，此时的查询性能最好，但有可能会读取到脏数据。</p><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code>dbcontext<span class="token punctuation">.</span><span class="token function">NoLock</span><span class="token punctuation">(</span>ctx<span class="token operator">=&gt;</span>ctx<span class="token punctuation">.</span>Users<span class="token range operator">..</span><span class="token punctuation">.</span><span class="token function">ToList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 开启一个nolock上下文，上下文范围内自动nolock</span>

<span class="token comment">// 执行单个nolock查询</span>
<span class="token keyword">await</span> dbcontext<span class="token punctuation">.</span>Users<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>x<span class="token operator">=&gt;</span>x<span class="token punctuation">.</span>Name<span class="token operator">==</span><span class="token string">&quot;aaa&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToListWithNoLockAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">await</span> dbcontext<span class="token punctuation">.</span>Users<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>x<span class="token operator">=&gt;</span>x<span class="token punctuation">.</span>Name<span class="token operator">==</span><span class="token string">&quot;aaa&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">FirstOrDefaultWithNoLockAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">await</span> dbcontext<span class="token punctuation">.</span>Users<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>x<span class="token operator">=&gt;</span>x<span class="token punctuation">.</span>Name<span class="token operator">==</span><span class="token string">&quot;aaa&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">SingleOrDefaultWithNoLockAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">await</span> dbcontext<span class="token punctuation">.</span>Users<span class="token punctuation">.</span><span class="token function">AnyWithNoLockAsync</span><span class="token punctuation">(</span>x<span class="token operator">=&gt;</span>x<span class="token punctuation">.</span>Name<span class="token operator">==</span><span class="token string">&quot;aaa&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">await</span> dbcontext<span class="token punctuation">.</span>Users<span class="token punctuation">.</span><span class="token function">AllWithNoLockAsync</span><span class="token punctuation">(</span>x<span class="token operator">=&gt;</span>x<span class="token punctuation">.</span>Name<span class="token operator">==</span><span class="token string">&quot;aaa&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">await</span> dbcontext<span class="token punctuation">.</span>Users<span class="token punctuation">.</span><span class="token function">CountWithNoLockAsync</span><span class="token punctuation">(</span>x<span class="token operator">=&gt;</span>x<span class="token punctuation">.</span>Name<span class="token operator">==</span><span class="token string">&quot;aaa&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 

<span class="token comment">// 如果在上下文开启了重试机制,执行单个nolock查询需要开启策略查询</span>
services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddDbContext</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>TContext<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>opt <span class="token operator">=&gt;</span> opt<span class="token punctuation">.</span><span class="token function">UseNpgsql</span><span class="token punctuation">(</span><span class="token string">&quot;ConnString&quot;</span><span class="token punctuation">,</span> builder <span class="token operator">=&gt;</span> builder<span class="token punctuation">.</span><span class="token function">EnableRetryOnFailure</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 执行策略</span>
dbcontext<span class="token punctuation">.</span><span class="token function">ExecutionStrategy</span><span class="token punctuation">(</span>stg<span class="token operator">=&gt;</span>stg<span class="token punctuation">.</span><span class="token function">NoLock</span><span class="token punctuation">(</span>ctx<span class="token operator">=&gt;</span>ctx<span class="token punctuation">.</span>Users<span class="token range operator">..</span><span class="token punctuation">.</span><span class="token function">ToList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
dbcontext<span class="token punctuation">.</span><span class="token function">ExecutionStrategy</span><span class="token punctuation">(</span>ctx<span class="token operator">=&gt;</span>ctx<span class="token punctuation">.</span>Users<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>x<span class="token operator">=&gt;</span>x<span class="token punctuation">.</span>Name<span class="token operator">==</span><span class="token string">&quot;aaa&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToListWithNoLockAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="自动递归式include扩展-通常用于树形表" tabindex="-1"><a class="header-anchor" href="#自动递归式include扩展-通常用于树形表" aria-hidden="true">#</a> 自动递归式Include扩展(通常用于树形表)</h4><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token comment">// 如果你现在正在写类似这样的代码：</span>
dbcontext<span class="token punctuation">.</span>Category<span class="token punctuation">.</span><span class="token function">Include</span><span class="token punctuation">(</span>c<span class="token operator">=&gt;</span>c<span class="token punctuation">.</span>Children<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ThenInclude</span><span class="token punctuation">(</span>c<span class="token operator">=&gt;</span>c<span class="token punctuation">.</span>Children<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ThenInclude</span><span class="token punctuation">(</span>c<span class="token operator">=&gt;</span>c<span class="token punctuation">.</span>Children<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ThenInclude</span><span class="token punctuation">(</span>c<span class="token operator">=&gt;</span>c<span class="token punctuation">.</span>Children<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 那么可以改成这样：</span>
dbcontext<span class="token punctuation">.</span>Category<span class="token punctuation">.</span><span class="token function">IncludeRecursive</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> c <span class="token operator">=&gt;</span> c<span class="token punctuation">.</span>Children<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 自动Include 4次</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_40-任何类型支持链式调用" tabindex="-1"><a class="header-anchor" href="#_40-任何类型支持链式调用" aria-hidden="true">#</a> 40.任何类型支持链式调用</h3><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code>a<span class="token punctuation">.</span><span class="token function">Next</span><span class="token punctuation">(</span>func1<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Next</span><span class="token punctuation">(</span>func2<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Next</span><span class="token punctuation">(</span>func3<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token string">&quot;123&quot;</span><span class="token punctuation">.</span><span class="token function">Next</span><span class="token punctuation">(</span>s<span class="token operator">=&gt;</span>s<span class="token punctuation">.</span><span class="token function">ToInt32</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Next</span><span class="token punctuation">(</span>x<span class="token operator">=&gt;</span>x<span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Next</span><span class="token punctuation">(</span>x<span class="token operator">=&gt;</span>Math<span class="token punctuation">.</span><span class="token function">Log</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_41-newtonsoft-json的只允许字段-反-序列化行为的契约解释器" tabindex="-1"><a class="header-anchor" href="#_41-newtonsoft-json的只允许字段-反-序列化行为的契约解释器" aria-hidden="true">#</a> 41.Newtonsoft.Json的只允许字段(反)序列化行为的契约解释器</h3><h4 id="deserializeonlycontractresolver" tabindex="-1"><a class="header-anchor" href="#deserializeonlycontractresolver" aria-hidden="true">#</a> DeserializeOnlyContractResolver</h4><p>该解释器针对类属性被DeserializeOnlyJsonPropertyAttribute/SerializeIgnoreAttribute标记的，在反序列化的时候生效，在序列化的时候忽略;被SerializeOnlyJsonPropertyAttribute/DeserializeIgnoreAttribute标记的，在序列化的时候生效，在反序列化的时候忽略</p><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ClassDto</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// 序列化时忽略这个属性/反序列化时加载这个属性</span>
        <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">DeserializeOnlyJsonProperty</span></span><span class="token punctuation">]</span>
        <span class="token comment">//[SerializeIgnore]</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> MyProperty <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

        <span class="token comment">// 反序列化时忽略这个属性/序列化时加载这个属性</span>
        <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">SerializeOnlyJsonProperty</span></span><span class="token punctuation">]</span>
        <span class="token comment">//[DeserializeIgnore]</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> Num <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  
    JsonConvert<span class="token punctuation">.</span><span class="token function">SerializeObject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">MyClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">JsonSerializerSettings</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        ContractResolver <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">DeserializeOnlyContractResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 配置使用DeserializeOnlyContractResolver解释器</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果是WebAPI全局使用：</p><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code>        <span class="token comment">//在Startup.ConfigureServices中</span>
        services<span class="token punctuation">.</span><span class="token function">AddMvc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">AddNewtonsoftJson</span><span class="token punctuation">(</span>options <span class="token operator">=&gt;</span>
             <span class="token punctuation">{</span>
                 <span class="token class-name"><span class="token keyword">var</span></span> resolver <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">DeserializeOnlyContractResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                 resolver<span class="token punctuation">.</span>NamingStrategy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">CamelCaseNamingStrategy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                 options<span class="token punctuation">.</span>SerializerSettings<span class="token punctuation">.</span>ContractResolver <span class="token operator">=</span> resolver<span class="token punctuation">;</span>
             <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="fallbackjsonpropertyresolver" tabindex="-1"><a class="header-anchor" href="#fallbackjsonpropertyresolver" aria-hidden="true">#</a> FallbackJsonPropertyResolver</h4><p>该解释器针对某个属性设置多个别名，反序列化时支持多个别名key进行绑定，弥补官方JsonProperty别名属性只能设置单一别名的不足</p><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code>    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ClassDto</span>
    <span class="token punctuation">{</span>
        <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">FallbackJsonProperty</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;MyProperty&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> MyProperty <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> Num <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  
    JsonConvert<span class="token punctuation">.</span><span class="token function">SerializeObject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">MyClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">JsonSerializerSettings</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        ContractResolver <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">FallbackJsonPropertyResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 配置使用FallbackJsonPropertyResolver解释器</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="compositecontractresolver" tabindex="-1"><a class="header-anchor" href="#compositecontractresolver" aria-hidden="true">#</a> CompositeContractResolver</h4><p>该解释器是DeserializeOnlyContractResolver和FallbackJsonPropertyResolver的融合版</p><h3 id="_42-asp-net-core-action同时支持querystring、表单和json请求类型的模型绑点器bodyordefaultmodelbinder" tabindex="-1"><a class="header-anchor" href="#_42-asp-net-core-action同时支持querystring、表单和json请求类型的模型绑点器bodyordefaultmodelbinder" aria-hidden="true">#</a> 42. ASP.NET Core Action同时支持queryString、表单和json请求类型的模型绑点器BodyOrDefaultModelBinder</h3><p>用法： 引入包：<code>Masuit.Tools.AspNetCore</code></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>PM<span class="token operator">&gt;</span> Install-Package Masuit.Tools.AspNetCore
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Startup配置：</p><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code>app<span class="token punctuation">.</span><span class="token function">UseBodyOrDefaultModelBinder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>在action的参数模型前打上标记：<code>[FromBodyOrDefault]</code>即可，示例代码如下：</p><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code>        <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">HttpGet</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;query&quot;</span><span class="token punctuation">)</span></span><span class="token punctuation">,</span><span class="token class-name">HttpPost</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;query&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
        <span class="token keyword">public</span> <span class="token return-type class-name">IActionResult</span> <span class="token function">Query</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">FromBodyOrDefault</span></span><span class="token punctuation">]</span><span class="token class-name">QueryModel</span> query<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token function">Ok</span><span class="token punctuation">(</span><span class="token range operator">..</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
  
        <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">HttpGet</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;query&quot;</span><span class="token punctuation">)</span></span><span class="token punctuation">,</span><span class="token class-name">HttpPost</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;query&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
        <span class="token keyword">public</span> <span class="token return-type class-name">IActionResult</span> <span class="token function">Query</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">FromBodyOrDefault</span></span><span class="token punctuation">]</span><span class="token class-name"><span class="token keyword">int</span></span> id<span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">FromBodyOrDefault</span></span><span class="token punctuation">]</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token function">Ok</span><span class="token punctuation">(</span><span class="token range operator">..</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_43-字符串simhash相似度算法" tabindex="-1"><a class="header-anchor" href="#_43-字符串simhash相似度算法" aria-hidden="true">#</a> 43. 字符串SimHash相似度算法</h3><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token class-name"><span class="token keyword">var</span></span> dis<span class="token operator">=</span><span class="token string">&quot;12345678&quot;</span><span class="token punctuation">.</span><span class="token function">HammingDistance</span><span class="token punctuation">(</span><span class="token string">&quot;1234567&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> dis<span class="token operator">=</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">SimHash</span><span class="token punctuation">(</span><span class="token string">&quot;12345678&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">HammingDistance</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">SimHash</span><span class="token punctuation">(</span><span class="token string">&quot;1234567&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_44-真实文件类型探测" tabindex="-1"><a class="header-anchor" href="#_44-真实文件类型探测" aria-hidden="true">#</a> 44. 真实文件类型探测</h3><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token comment">// 多种方式，任君调用</span>
<span class="token class-name"><span class="token keyword">var</span></span> detector<span class="token operator">=</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">FileInfo</span><span class="token punctuation">(</span>filepath<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">DetectFiletype</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//var detector=File.OpenRead(filepath).DetectFiletype();</span>
<span class="token comment">//var detector=FileSignatureDetector.DetectFiletype(filepath);</span>
detector<span class="token punctuation">.</span>Precondition<span class="token punctuation">;</span><span class="token comment">//基础文件类型</span>
detector<span class="token punctuation">.</span>Extension<span class="token punctuation">;</span><span class="token comment">//真实扩展名</span>
detector<span class="token punctuation">.</span>MimeType<span class="token punctuation">;</span><span class="token comment">//MimeType</span>
detector<span class="token punctuation">.</span>FormatCategories<span class="token punctuation">;</span><span class="token comment">//格式类别</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="默认支持的文件类型" tabindex="-1"><a class="header-anchor" href="#默认支持的文件类型" aria-hidden="true">#</a> 默认支持的文件类型</h4><table><thead><tr><th style="text-align:center;">扩展名</th><th style="text-align:center;">说明</th></tr></thead><tbody><tr><td style="text-align:center;">3GP</td><td style="text-align:center;">3GPP, 3GPP 2</td></tr><tr><td style="text-align:center;">7Z</td><td style="text-align:center;">7-Zip</td></tr><tr><td style="text-align:center;">APK</td><td style="text-align:center;">ZIP based Android Package</td></tr><tr><td style="text-align:center;">AVI</td><td style="text-align:center;">Audio-Video Interleave</td></tr><tr><td style="text-align:center;">SH</td><td style="text-align:center;">Shell Script</td></tr><tr><td style="text-align:center;">BPLIST</td><td style="text-align:center;">Binary Property List</td></tr><tr><td style="text-align:center;">BMP, DIB</td><td style="text-align:center;">Bitmap</td></tr><tr><td style="text-align:center;">BZ2</td><td style="text-align:center;">Bunzip2 Compressed</td></tr><tr><td style="text-align:center;">CAB</td><td style="text-align:center;">Microsoft Cabinet</td></tr><tr><td style="text-align:center;">CLASS</td><td style="text-align:center;">Java Bytecode</td></tr><tr><td style="text-align:center;">CONFIG</td><td style="text-align:center;">.NET Configuration File</td></tr><tr><td style="text-align:center;">CRT, CERT</td><td style="text-align:center;">Certificate</td></tr><tr><td style="text-align:center;">CUR</td><td style="text-align:center;">Cursor</td></tr><tr><td style="text-align:center;">DB</td><td style="text-align:center;">Windows Thumbs.db Thumbnail Database</td></tr><tr><td style="text-align:center;">DDS</td><td style="text-align:center;">DirectDraw Surface</td></tr><tr><td style="text-align:center;">DLL</td><td style="text-align:center;">Windows Dynamic Linkage Library</td></tr><tr><td style="text-align:center;">DMG</td><td style="text-align:center;">Apple Disk Mount Image</td></tr><tr><td style="text-align:center;">DMP</td><td style="text-align:center;">Windows Memory Dump File</td></tr><tr><td style="text-align:center;">DOC</td><td style="text-align:center;">Microsoft Office Word 97-2003 Document</td></tr><tr><td style="text-align:center;">DOCX</td><td style="text-align:center;">Microsoft Office Word OpenXML Document</td></tr><tr><td style="text-align:center;">EPUB</td><td style="text-align:center;">e-Pub Document</td></tr><tr><td style="text-align:center;">EXE</td><td style="text-align:center;">Windows Executive</td></tr><tr><td style="text-align:center;">FLAC</td><td style="text-align:center;">Loseless Audio</td></tr><tr><td style="text-align:center;">FLV</td><td style="text-align:center;">Flash Video</td></tr><tr><td style="text-align:center;">GIF</td><td style="text-align:center;">Graphics Interchage Format</td></tr><tr><td style="text-align:center;">GZ</td><td style="text-align:center;">GZ Compressed</td></tr><tr><td style="text-align:center;">HDP</td><td style="text-align:center;">HD Photo(JPEG XR) Image</td></tr><tr><td style="text-align:center;">HWP</td><td style="text-align:center;">Legacy HWP, HWPML, CFBF HWP</td></tr><tr><td style="text-align:center;">ICO</td><td style="text-align:center;">Icon</td></tr><tr><td style="text-align:center;">INI</td><td style="text-align:center;">Initialization File</td></tr><tr><td style="text-align:center;">ISO</td><td style="text-align:center;">ISO-9660 Disc Image</td></tr><tr><td style="text-align:center;">LNK</td><td style="text-align:center;">Windows Shortcut Link</td></tr><tr><td style="text-align:center;">JP2</td><td style="text-align:center;">JPEG 2000 Image</td></tr><tr><td style="text-align:center;">JPG, JPEG</td><td style="text-align:center;">Joint Photographic Experts Group Image</td></tr><tr><td style="text-align:center;">LZH</td><td style="text-align:center;">LZH Compressed</td></tr><tr><td style="text-align:center;">M4A</td><td style="text-align:center;">MP4 Container Contained Audio Only</td></tr><tr><td style="text-align:center;">M4V</td><td style="text-align:center;">MP4 Container Contained Video</td></tr><tr><td style="text-align:center;">MID</td><td style="text-align:center;">Midi Sound</td></tr><tr><td style="text-align:center;">MKA</td><td style="text-align:center;">Matroska Container Contained Audio Only</td></tr><tr><td style="text-align:center;">MKV</td><td style="text-align:center;">Matroska Container Contained Video</td></tr><tr><td style="text-align:center;">MOV</td><td style="text-align:center;">QuickTime Movie Video</td></tr><tr><td style="text-align:center;">MP4</td><td style="text-align:center;">MP4 Container Contained Contents</td></tr><tr><td style="text-align:center;">MSI</td><td style="text-align:center;">Microsoft Installer</td></tr><tr><td style="text-align:center;">OGG</td><td style="text-align:center;">OGG Video or Audio</td></tr><tr><td style="text-align:center;">ODF</td><td style="text-align:center;">OpenDocument Formula</td></tr><tr><td style="text-align:center;">ODG</td><td style="text-align:center;">OpenDocument Graphics</td></tr><tr><td style="text-align:center;">ODP</td><td style="text-align:center;">OpenDocument Presentation</td></tr><tr><td style="text-align:center;">ODS</td><td style="text-align:center;">OpenDocument Spreadsheet</td></tr><tr><td style="text-align:center;">ODT</td><td style="text-align:center;">OpenDocument Text</td></tr><tr><td style="text-align:center;">PAK</td><td style="text-align:center;">PAK Archive or Quake Archive</td></tr><tr><td style="text-align:center;">PDB</td><td style="text-align:center;">Microsoft Program Database</td></tr><tr><td style="text-align:center;">PDF</td><td style="text-align:center;">Portable Document Format</td></tr><tr><td style="text-align:center;">PFX</td><td style="text-align:center;">Microsoft Personal Information Exchange Certificate</td></tr><tr><td style="text-align:center;">PNG</td><td style="text-align:center;">Portable Network Graphics Image</td></tr><tr><td style="text-align:center;">PPT</td><td style="text-align:center;">Microsoft Office PowerPoint 97-2003 Document</td></tr><tr><td style="text-align:center;">PPTX</td><td style="text-align:center;">Microsoft Office PowerPoint OpenXML Document</td></tr><tr><td style="text-align:center;">PPSX</td><td style="text-align:center;">Microsoft Office PowerPoint OpenXML Document for Slideshow only</td></tr><tr><td style="text-align:center;">PSD</td><td style="text-align:center;">Photoshop Document</td></tr><tr><td style="text-align:center;">RAR</td><td style="text-align:center;">WinRAR Compressed</td></tr><tr><td style="text-align:center;">REG</td><td style="text-align:center;">Windows Registry</td></tr><tr><td style="text-align:center;">RPM</td><td style="text-align:center;">RedHat Package Manager Package</td></tr><tr><td style="text-align:center;">RTF</td><td style="text-align:center;">Rich Text Format Document</td></tr><tr><td style="text-align:center;">SLN</td><td style="text-align:center;">Microsoft Visual Studio Solution</td></tr><tr><td style="text-align:center;">SRT</td><td style="text-align:center;">SubRip Subtitle</td></tr><tr><td style="text-align:center;">SWF</td><td style="text-align:center;">Shockwave Flash</td></tr><tr><td style="text-align:center;">SQLITE, DB</td><td style="text-align:center;">SQLite Database</td></tr><tr><td style="text-align:center;">TAR</td><td style="text-align:center;">pre-ISO Type and UStar Type TAR Package</td></tr><tr><td style="text-align:center;">TIFF</td><td style="text-align:center;">Tagged Image File Format Image</td></tr><tr><td style="text-align:center;">TXT</td><td style="text-align:center;">Plain Text</td></tr><tr><td style="text-align:center;">WAV</td><td style="text-align:center;">Wave Audio</td></tr><tr><td style="text-align:center;">WASM</td><td style="text-align:center;">Binary WebAssembly</td></tr><tr><td style="text-align:center;">WEBM</td><td style="text-align:center;">WebM Video</td></tr><tr><td style="text-align:center;">WEBP</td><td style="text-align:center;">WebP Image</td></tr><tr><td style="text-align:center;">XAR</td><td style="text-align:center;">XAR Package</td></tr><tr><td style="text-align:center;">XLS</td><td style="text-align:center;">Microsoft Office Excel 97-2003 Document</td></tr><tr><td style="text-align:center;">XLSX</td><td style="text-align:center;">Microsoft Office Excep OpenXML Document</td></tr><tr><td style="text-align:center;">XML</td><td style="text-align:center;">Extensible Markup Language Document</td></tr><tr><td style="text-align:center;">Z</td><td style="text-align:center;">Z Compressed</td></tr><tr><td style="text-align:center;">ZIP</td><td style="text-align:center;">ZIP Package</td></tr></tbody></table><h3 id="_45-动态类型扩展" tabindex="-1"><a class="header-anchor" href="#_45-动态类型扩展" aria-hidden="true">#</a> 45. 动态类型扩展</h3><p>让动态类型支持属性访问器和索引器调用</p><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code>        <span class="token class-name"><span class="token keyword">var</span></span> obj <span class="token operator">=</span> DynamicFactory<span class="token punctuation">.</span><span class="token function">NewObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        obj<span class="token punctuation">.</span>Name <span class="token operator">=</span> <span class="token string">&quot;Masuit&quot;</span><span class="token punctuation">;</span>
        obj<span class="token punctuation">.</span>Age <span class="token operator">=</span> <span class="token number">18</span><span class="token punctuation">;</span>
        obj<span class="token punctuation">[</span><span class="token string">&quot;Gender&quot;</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">&quot;男&quot;</span>
        obj<span class="token punctuation">.</span>MyClass <span class="token operator">=</span> DynamicFactory<span class="token punctuation">.</span><span class="token function">WithObject</span><span class="token punctuation">(</span><span class="token keyword">new</span>
        <span class="token punctuation">{</span>
            X <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">,</span>
            Y <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">,</span>
            Z <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">List<span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span> <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Assert<span class="token punctuation">.</span><span class="token function">Equal</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>Name<span class="token punctuation">,</span> obj<span class="token punctuation">[</span><span class="token string">&quot;Name&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Assert<span class="token punctuation">.</span><span class="token function">Equal</span><span class="token punctuation">(</span>obj<span class="token punctuation">[</span><span class="token string">&quot;Gender&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> obj<span class="token punctuation">.</span>Gender<span class="token punctuation">)</span><span class="token punctuation">;</span>
        Assert<span class="token punctuation">.</span><span class="token function">Equal</span><span class="token punctuation">(</span>obj<span class="token punctuation">[</span><span class="token string">&quot;MyClass&quot;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&quot;X&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> obj<span class="token punctuation">.</span>MyClass<span class="token punctuation">.</span>X<span class="token punctuation">)</span><span class="token punctuation">;</span>
        Assert<span class="token punctuation">.</span><span class="token function">Equal</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>MyClass<span class="token punctuation">.</span>Z<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> obj<span class="token punctuation">[</span><span class="token string">&quot;MyClass&quot;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&quot;Z&quot;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>普通类型转换成动态类型</p><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code>        <span class="token class-name"><span class="token keyword">var</span></span> obj <span class="token operator">=</span> <span class="token keyword">new</span>
        <span class="token punctuation">{</span>
            Name <span class="token operator">=</span> <span class="token string">&quot;Masuit&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">ToDynamic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        obj<span class="token punctuation">.</span>Age <span class="token operator">=</span> <span class="token number">18</span><span class="token punctuation">;</span>
        obj<span class="token punctuation">.</span>MyClass <span class="token operator">=</span> <span class="token keyword">new</span>
        <span class="token punctuation">{</span>
            X <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">,</span>
            Y <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">,</span>
            Z <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">List<span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span> <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">ToDynamic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        obj<span class="token punctuation">.</span>Prop <span class="token operator">=</span> <span class="token string">&quot;test&quot;</span><span class="token punctuation">;</span>
        _ <span class="token operator">=</span> obj <span class="token operator">-</span> <span class="token string">&quot;Prop&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 删除属性</span>
        _ <span class="token operator">=</span> obj <span class="token operator">+</span> <span class="token string">&quot;Prop&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 增加属性</span>

        Assert<span class="token punctuation">.</span><span class="token function">Equal</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>Name<span class="token punctuation">,</span> obj<span class="token punctuation">[</span><span class="token string">&quot;Name&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Assert<span class="token punctuation">.</span><span class="token function">Equal</span><span class="token punctuation">(</span>obj<span class="token punctuation">[</span><span class="token string">&quot;MyClass&quot;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&quot;X&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> obj<span class="token punctuation">.</span>MyClass<span class="token punctuation">.</span>X<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_46-反病毒-仅支持windows" tabindex="-1"><a class="header-anchor" href="#_46-反病毒-仅支持windows" aria-hidden="true">#</a> 46. 反病毒(仅支持Windows)</h3><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token comment">// 要求系统WindowsDefender没有被停掉</span>
<span class="token class-name"><span class="token keyword">var</span></span> result <span class="token operator">=</span> WindowsDefenderScanService<span class="token punctuation">.</span><span class="token function">ScanFile</span><span class="token punctuation">(</span><span class="token string">@&quot;Y:\1.exe&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 扫描文件</span>
<span class="token class-name"><span class="token keyword">var</span></span> result <span class="token operator">=</span> WindowsDefenderScanService<span class="token punctuation">.</span><span class="token function">ScanDirectory</span><span class="token punctuation">(</span><span class="token string">@&quot;Y:\&quot;); // 扫描文件夹
var result = WindowsDefenderScanService.ScanStream(stream); // 扫描文件流

// 要求C:\Windows\System32\amsi.dll文件存在，可在WindowsDefender停止时工作
AmsiScanService.Scan(stream); // 扫描文件流
AmsiScanService.Scan(@&quot;</span>Y<span class="token punctuation">:</span>\<span class="token number">1</span><span class="token punctuation">.</span>exe&quot;<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 扫描文件</span>
AmsiScanService<span class="token punctuation">.</span><span class="token function">Scan</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 扫描二进制数组</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_47-生成验证码" tabindex="-1"><a class="header-anchor" href="#_47-生成验证码" aria-hidden="true">#</a> 47. 生成验证码</h3><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token class-name"><span class="token keyword">var</span></span> code<span class="token operator">=</span>ValidateCode<span class="token punctuation">.</span><span class="token function">ValidateCode</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 生成6位长度的验证码</span>
<span class="token class-name"><span class="token keyword">var</span></span> stream<span class="token operator">=</span>code<span class="token punctuation">.</span><span class="token function">CreateValidateGraphic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 生成验证码图片流</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_48-distributedcache扩展" tabindex="-1"><a class="header-anchor" href="#_48-distributedcache扩展" aria-hidden="true">#</a> 48. DistributedCache扩展</h3><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token class-name"><span class="token keyword">var</span></span> item<span class="token operator">=</span>cache<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Get</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获取值</span>
<span class="token class-name"><span class="token keyword">var</span></span> item<span class="token operator">=</span>cache<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetOrAdd</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>key<span class="token punctuation">,</span><span class="token keyword">value</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获取或添加值</span>
<span class="token class-name"><span class="token keyword">var</span></span> item<span class="token operator">=</span>cache<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetOrAdd</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>key<span class="token punctuation">,</span>valueFactory<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获取或添加值</span>
cache<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Set</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>key<span class="token punctuation">,</span><span class="token keyword">value</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设置值</span>
cache<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddOrUpdate</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>key<span class="token punctuation">,</span><span class="token keyword">value</span><span class="token punctuation">,</span>valueFactory<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 添加或更新值</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_49-viewdata扩展" tabindex="-1"><a class="header-anchor" href="#_49-viewdata扩展" aria-hidden="true">#</a> 49. ViewData扩展</h3><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token class-name"><span class="token keyword">var</span></span> item<span class="token operator">=</span>ViewData<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetValue</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//获取对象</span>
<span class="token class-name"><span class="token keyword">var</span></span> item<span class="token operator">=</span>ViewData<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetValueOrDefault</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>key<span class="token punctuation">,</span>defaultValue<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//获取对象</span>
<span class="token class-name"><span class="token keyword">var</span></span> item<span class="token operator">=</span>ViewData<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetValueOrDefault</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>key<span class="token punctuation">,</span>defaultValueFactory<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//获取对象</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_50-线程上下文存取临时值" tabindex="-1"><a class="header-anchor" href="#_50-线程上下文存取临时值" aria-hidden="true">#</a> 50. 线程上下文存取临时值</h3><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code>CurrentContext<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token punctuation">.</span><span class="token function">SetData</span><span class="token punctuation">(</span><span class="token keyword">value</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//设置值</span>
<span class="token class-name"><span class="token keyword">var</span></span> item<span class="token operator">=</span>CurrentContext<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token punctuation">.</span><span class="token function">GetData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//获取值</span>

CurrentContext<span class="token punctuation">.</span><span class="token function">SetData</span><span class="token punctuation">(</span><span class="token keyword">value</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//设置值</span>
<span class="token class-name"><span class="token keyword">var</span></span> item<span class="token operator">=</span>CurrentContext<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetData</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//获取值</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_51-asp-net-core自动扫描注册服务" tabindex="-1"><a class="header-anchor" href="#_51-asp-net-core自动扫描注册服务" aria-hidden="true">#</a> 51. ASP.NET Core自动扫描注册服务</h3><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token comment">// 自动扫描注册服务</span>
services<span class="token punctuation">.</span><span class="token function">AutoRegisterServices</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 需要自动注册的服务打上ServiceInject标记即可。</span>
<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">ServiceInject</span><span class="token attribute-arguments"><span class="token punctuation">(</span>ServiceLifetime<span class="token punctuation">.</span>Scoped<span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyClass</span><span class="token punctuation">:</span><span class="token type-list"><span class="token class-name">MyInterface</span></span><span class="token punctuation">{</span><span class="token range operator">..</span><span class="token punctuation">.</span><span class="token punctuation">}</span>

<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">ServiceInject</span><span class="token attribute-arguments"><span class="token punctuation">(</span>ServiceLifetime<span class="token punctuation">.</span>Scoped<span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyService</span><span class="token punctuation">{</span><span class="token range operator">..</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="asp-net-mvc和asp-net-core的支持断点续传和多线程下载的resumefileresult" tabindex="-1"><a class="header-anchor" href="#asp-net-mvc和asp-net-core的支持断点续传和多线程下载的resumefileresult" aria-hidden="true">#</a> Asp.Net MVC和Asp.Net Core的支持断点续传和多线程下载的ResumeFileResult</h1><p>在ASP.NET Core中通过MVC/WebAPI应用程序传输文件数据时使用断点续传以及多线程下载支持。</p><p>它提供了 <code>ETag</code>标头以及 <code>Last-Modified</code>标头。 它还支持以下前置条件标头：<code>If-Match</code>，<code>If-None-Match</code>，<code>If-Modified-Since</code>，<code>If-Unmodified-Since</code>，<code>If-Range</code>。</p><h2 id="支持-asp-net-core-2-0" tabindex="-1"><a class="header-anchor" href="#支持-asp-net-core-2-0" aria-hidden="true">#</a> 支持 ASP.NET Core 2.0+</h2><p>从.NET Core2.0开始，ASP.NET Core内部支持断点续传。 因此只是对FileResult做了一些扩展。 只留下了“Content-Disposition” Inline的一部分。 所有代码都依赖于基础.NET类。</p><h2 id="如何使用" tabindex="-1"><a class="header-anchor" href="#如何使用" aria-hidden="true">#</a> 如何使用</h2><h3 id="net-framework" tabindex="-1"><a class="header-anchor" href="#net-framework" aria-hidden="true">#</a> .NET Framework</h3><p>在你的控制器中，你可以像在 <code>FileResult</code>一样的方式使用它。</p><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token namespace">Masuit<span class="token punctuation">.</span>Tools<span class="token punctuation">.</span>Mvc</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Masuit<span class="token punctuation">.</span>Tools<span class="token punctuation">.</span>Mvc<span class="token punctuation">.</span>ResumeFileResult</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">MimeMapper</span> mimeMapper<span class="token operator">=</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">MimeMapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 推荐使用依赖注入</span>

<span class="token keyword">public</span> <span class="token return-type class-name">ActionResult</span> <span class="token function">ResumeFileResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">var</span></span> path <span class="token operator">=</span> Server<span class="token punctuation">.</span><span class="token function">MapPath</span><span class="token punctuation">(</span><span class="token string">&quot;~/Content/test.mp4&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ResumeFileResult</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> mimeMapper<span class="token punctuation">.</span><span class="token function">GetMimeFromPath</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">,</span> Request<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token return-type class-name">ActionResult</span> <span class="token function">ResumeFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">ResumeFile</span><span class="token punctuation">(</span><span class="token string">&quot;~/Content/test.mp4&quot;</span><span class="token punctuation">,</span> mimeMapper<span class="token punctuation">.</span><span class="token function">GetMimeFromPath</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;test.mp4&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token return-type class-name">ActionResult</span> <span class="token function">ResumePhysicalFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">ResumePhysicalFile</span><span class="token punctuation">(</span><span class="token string">@&quot;D:/test.mp4&quot;</span><span class="token punctuation">,</span> mimeMapper<span class="token punctuation">.</span><span class="token function">GetMimeFromPath</span><span class="token punctuation">(</span><span class="token string">@&quot;D:/test.mp4&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;test.mp4&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="asp-net-core" tabindex="-1"><a class="header-anchor" href="#asp-net-core" aria-hidden="true">#</a> Asp.Net Core</h3><p>要使用ResumeFileResults，必须在 <code>Startup.cs</code>的 <code>ConfigureServices</code>方法调用中配置服务：</p><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token namespace">Masuit<span class="token punctuation">.</span>Tools<span class="token punctuation">.</span>AspNetCore<span class="token punctuation">.</span>ResumeFileResults<span class="token punctuation">.</span>Extensions</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ConfigureServices</span><span class="token punctuation">(</span><span class="token class-name">IServiceCollection</span> services<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    services<span class="token punctuation">.</span><span class="token function">AddResumeFileResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>然后在你的控制器中，你可以像在 <code>FileResult</code>一样的方式使用它。</p><details><summary>点击查看代码</summary><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token namespace">Masuit<span class="token punctuation">.</span>Tools<span class="token punctuation">.</span>AspNetCore<span class="token punctuation">.</span>ResumeFileResults<span class="token punctuation">.</span>Extensions</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token keyword">private</span> <span class="token keyword">const</span> <span class="token class-name"><span class="token keyword">string</span></span> EntityTag <span class="token operator">=</span> <span class="token string">&quot;\&quot;TestFile\&quot;&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">IHostingEnvironment</span> _hostingEnvironment<span class="token punctuation">;</span>

<span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">DateTimeOffset</span> _lastModified <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">DateTimeOffset</span><span class="token punctuation">(</span><span class="token number">2016</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> TimeSpan<span class="token punctuation">.</span>Zero<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span></span>
<span class="token doc-comment comment">/// </span>
<span class="token doc-comment comment">/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span></span>
<span class="token doc-comment comment">/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hostingEnvironment<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param</span><span class="token punctuation">&gt;</span></span></span>
<span class="token keyword">public</span> <span class="token function">TestController</span><span class="token punctuation">(</span><span class="token class-name">IHostingEnvironment</span> hostingEnvironment<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    _hostingEnvironment <span class="token operator">=</span> hostingEnvironment<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">HttpGet</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;content/{fileName}/{etag}&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token return-type class-name">IActionResult</span> <span class="token function">FileContent</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">bool</span></span> fileName<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">bool</span></span> etag<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">string</span></span> webRoot <span class="token operator">=</span> _hostingEnvironment<span class="token punctuation">.</span>WebRootPath<span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">var</span></span> content <span class="token operator">=</span> System<span class="token punctuation">.</span>IO<span class="token punctuation">.</span>File<span class="token punctuation">.</span><span class="token function">ReadAllBytes</span><span class="token punctuation">(</span>Path<span class="token punctuation">.</span><span class="token function">Combine</span><span class="token punctuation">(</span>webRoot<span class="token punctuation">,</span> <span class="token string">&quot;TestFile.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">ResumeFileContentResult</span> result <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">ResumeFile</span><span class="token punctuation">(</span>content<span class="token punctuation">,</span> <span class="token string">&quot;text/plain&quot;</span><span class="token punctuation">,</span> fileName <span class="token punctuation">?</span> <span class="token string">&quot;TestFile.txt&quot;</span> <span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token class-name">etag <span class="token punctuation">?</span></span> EntityTag <span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    result<span class="token punctuation">.</span>LastModified <span class="token operator">=</span> _lastModified<span class="token punctuation">;</span>
    <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">HttpGet</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;content/{fileName}&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token return-type class-name">IActionResult</span> <span class="token function">FileContent</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">bool</span></span> fileName<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">string</span></span> webRoot <span class="token operator">=</span> _hostingEnvironment<span class="token punctuation">.</span>WebRootPath<span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">var</span></span> content <span class="token operator">=</span> System<span class="token punctuation">.</span>IO<span class="token punctuation">.</span>File<span class="token punctuation">.</span><span class="token function">ReadAllBytes</span><span class="token punctuation">(</span>Path<span class="token punctuation">.</span><span class="token function">Combine</span><span class="token punctuation">(</span>webRoot<span class="token punctuation">,</span> <span class="token string">&quot;TestFile.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">var</span></span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ResumeFileContentResult</span><span class="token punctuation">(</span>content<span class="token punctuation">,</span> <span class="token string">&quot;text/plain&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        FileInlineName <span class="token operator">=</span> <span class="token string">&quot;TestFile.txt&quot;</span><span class="token punctuation">,</span>
        LastModified <span class="token operator">=</span> _lastModified
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">HttpHead</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;file&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token return-type class-name">IActionResult</span> <span class="token function">FileHead</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name">ResumeVirtualFileResult</span> result <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">ResumeFile</span><span class="token punctuation">(</span><span class="token string">&quot;TestFile.txt&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;text/plain&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;TestFile.txt&quot;</span><span class="token punctuation">,</span> EntityTag<span class="token punctuation">)</span><span class="token punctuation">;</span>
    result<span class="token punctuation">.</span>LastModified <span class="token operator">=</span> _lastModified<span class="token punctuation">;</span>
    <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">HttpPut</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;file&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token return-type class-name">IActionResult</span> <span class="token function">FilePut</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name">ResumeVirtualFileResult</span> result <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">ResumeFile</span><span class="token punctuation">(</span><span class="token string">&quot;TestFile.txt&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;text/plain&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;TestFile.txt&quot;</span><span class="token punctuation">,</span> EntityTag<span class="token punctuation">)</span><span class="token punctuation">;</span>
    result<span class="token punctuation">.</span>LastModified <span class="token operator">=</span> _lastModified<span class="token punctuation">;</span>
    <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">HttpGet</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;stream/{fileName}/{etag}&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token return-type class-name">IActionResult</span> <span class="token function">FileStream</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">bool</span></span> fileName<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">bool</span></span> etag<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">string</span></span> webRoot <span class="token operator">=</span> _hostingEnvironment<span class="token punctuation">.</span>WebRootPath<span class="token punctuation">;</span>
    <span class="token class-name">FileStream</span> stream <span class="token operator">=</span> System<span class="token punctuation">.</span>IO<span class="token punctuation">.</span>File<span class="token punctuation">.</span><span class="token function">OpenRead</span><span class="token punctuation">(</span>Path<span class="token punctuation">.</span><span class="token function">Combine</span><span class="token punctuation">(</span>webRoot<span class="token punctuation">,</span> <span class="token string">&quot;TestFile.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">ResumeFileStreamResult</span> result <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">ResumeFile</span><span class="token punctuation">(</span>stream<span class="token punctuation">,</span> <span class="token string">&quot;text/plain&quot;</span><span class="token punctuation">,</span> fileName <span class="token punctuation">?</span> <span class="token string">&quot;TestFile.txt&quot;</span> <span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token class-name">etag <span class="token punctuation">?</span></span> EntityTag <span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    result<span class="token punctuation">.</span>LastModified <span class="token operator">=</span> _lastModified<span class="token punctuation">;</span>
    <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">HttpGet</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;stream/{fileName}&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token return-type class-name">IActionResult</span> <span class="token function">FileStream</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">bool</span></span> fileName<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">string</span></span> webRoot <span class="token operator">=</span> _hostingEnvironment<span class="token punctuation">.</span>WebRootPath<span class="token punctuation">;</span>
    <span class="token class-name">FileStream</span> stream <span class="token operator">=</span> System<span class="token punctuation">.</span>IO<span class="token punctuation">.</span>File<span class="token punctuation">.</span><span class="token function">OpenRead</span><span class="token punctuation">(</span>Path<span class="token punctuation">.</span><span class="token function">Combine</span><span class="token punctuation">(</span>webRoot<span class="token punctuation">,</span> <span class="token string">&quot;TestFile.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name"><span class="token keyword">var</span></span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ResumeFileStreamResult</span><span class="token punctuation">(</span>stream<span class="token punctuation">,</span> <span class="token string">&quot;text/plain&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        FileInlineName <span class="token operator">=</span> <span class="token string">&quot;TestFile.txt&quot;</span><span class="token punctuation">,</span>
        LastModified <span class="token operator">=</span> _lastModified
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">HttpGet</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;physical/{fileName}/{etag}&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token return-type class-name">IActionResult</span> <span class="token function">PhysicalFile</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">bool</span></span> fileName<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">bool</span></span> etag<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">string</span></span> webRoot <span class="token operator">=</span> _hostingEnvironment<span class="token punctuation">.</span>WebRootPath<span class="token punctuation">;</span>

    <span class="token class-name">ResumePhysicalFileResult</span> result <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">ResumePhysicalFile</span><span class="token punctuation">(</span>Path<span class="token punctuation">.</span><span class="token function">Combine</span><span class="token punctuation">(</span>webRoot<span class="token punctuation">,</span> <span class="token string">&quot;TestFile.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;text/plain&quot;</span><span class="token punctuation">,</span> fileName <span class="token punctuation">?</span> <span class="token string">&quot;TestFile.txt&quot;</span> <span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token class-name">etag <span class="token punctuation">?</span></span> EntityTag <span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    result<span class="token punctuation">.</span>LastModified <span class="token operator">=</span> _lastModified<span class="token punctuation">;</span>
    <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">HttpGet</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;physical/{fileName}&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token return-type class-name">IActionResult</span> <span class="token function">PhysicalFile</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">bool</span></span> fileName<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">string</span></span> webRoot <span class="token operator">=</span> _hostingEnvironment<span class="token punctuation">.</span>WebRootPath<span class="token punctuation">;</span>

    <span class="token class-name"><span class="token keyword">var</span></span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ResumePhysicalFileResult</span><span class="token punctuation">(</span>Path<span class="token punctuation">.</span><span class="token function">Combine</span><span class="token punctuation">(</span>webRoot<span class="token punctuation">,</span> <span class="token string">&quot;TestFile.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;text/plain&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        FileInlineName <span class="token operator">=</span> <span class="token string">&quot;TestFile.txt&quot;</span><span class="token punctuation">,</span>
        LastModified <span class="token operator">=</span> _lastModified
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">HttpGet</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;virtual/{fileName}/{etag}&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token return-type class-name">IActionResult</span> <span class="token function">VirtualFile</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">bool</span></span> fileName<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">bool</span></span> etag<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name">ResumeVirtualFileResult</span> result <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">ResumeFile</span><span class="token punctuation">(</span><span class="token string">&quot;TestFile.txt&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;text/plain&quot;</span><span class="token punctuation">,</span> fileName <span class="token punctuation">?</span> <span class="token string">&quot;TestFile.txt&quot;</span> <span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token class-name">etag <span class="token punctuation">?</span></span> EntityTag <span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    result<span class="token punctuation">.</span>LastModified <span class="token operator">=</span> _lastModified<span class="token punctuation">;</span>
    <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>以上示例将为您的数据提供“Content-Disposition：attachment”。 当没有提供fileName时，数据将作为“Content-Disposition：inline”提供。 另外，它可以提供 <code>ETag</code>和 <code>LastModified</code>标头。</p><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">HttpGet</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;virtual/{fileName}&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token return-type class-name">IActionResult</span> <span class="token function">VirtualFile</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">bool</span></span> fileName<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">var</span></span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ResumeVirtualFileResult</span><span class="token punctuation">(</span><span class="token string">&quot;TestFile.txt&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;text/plain&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        FileInlineName <span class="token operator">=</span> <span class="token string">&quot;TestFile.txt&quot;</span><span class="token punctuation">,</span>
        LastModified <span class="token operator">=</span> _lastModified
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></details></div><!--[--><!--]--></div><footer class="page-meta"><div class="meta-item edit-link"><a class="external-link meta-item-label" href="https://github.com/ldqk/Masuit.Tools/edit/main/Use.md" rel="noopener noreferrer" target="_blank" aria-label="Edit this page"><!--[--><!--]--> Edit this page <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: 514324468@qq.com">514324468@qq.com</span><!--[-->, <!--]--><!--]--><!--[--><span class="contributor" title="email: admin@masuit.com">懒得勤快</span><!----><!--]--><!--]--></span></div></footer><!----><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/assets/app-91c53015.js" defer></script>
  </body>
</html>
